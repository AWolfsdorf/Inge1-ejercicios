

----STARTUP---- (24 June 2021 21:36:33) as /home/nikita/r/f/ingsoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/CuisUniversity-4532.image!


TestCase subclass: #CheckOutTest
	instanceVariableNames: 'creditCardNumber cardOwner validCreditCard book1 book2 expiredCreditCard currentMonth today expiredThisMonthCreditCard mockAlwaysStolenCardMerchantProcessor mockAlwaysOkMerchantProcessor mockAlwaysFakeCardMerchantProcessor mockAlwaysWithoutCreditCardMerchantProcessor invalidNumberCreditCard emptyOwnerCreditCard emptyOwnerCreditCard2 stubs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #CheckOutTest category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:15'!
TestCase subclass: #CheckOutTest
	instanceVariableNames: 'creditCardNumber cardOwner validCreditCard book1 book2 expiredCreditCard currentMonth today expiredThisMonthCreditCard mockAlwaysStolenCardMerchantProcessor mockAlwaysOkMerchantProcessor mockAlwaysFakeCardMerchantProcessor mockAlwaysWithoutCreditCardMerchantProcessor invalidNumberCreditCard emptyOwnerCreditCard emptyOwnerCreditCard2 stubs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!CheckOutTest methodsFor: 'valid checkout' stamp: 'nz 6/23/2021 01:25:02'!
 test02CheckoutACartWithOneItem

	| aCashier bookPrices cart receipt receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 124.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 1 of: book1.
	
	receipt _ aCashier checkOut: cart payingWith: validCreditCard on: today.
	
	self assert: 124 equals: receipt total.
	self assert: 1 equals: receipt items size.
	self assert: 1 equals: (receipt items occurrencesOf: book1).
	
	self assert: receipt isTheOnlyIn: receiptBook.! !
!CheckOutTest methodsFor: 'valid checkout' stamp: 'nz 6/23/2021 01:27:57'!
                       test03CheckoutACartWithMultipleItems

	| aCashier bookPrices cart receipt receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 100.
	bookPrices set: book2 price: 25.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 1 of: book1.
	cart add: 2 of: book2.
	
	receipt _ aCashier checkOut: cart payingWith: validCreditCard on: today.
	
	self assert: 150 equals: receipt total.
	self assert: 3 equals: receipt items size.
	self assert: 1 equals: (receipt items occurrencesOf: book1).
	self assert: 2 equals: (receipt items occurrencesOf: book2).

	self assert: receipt isTheOnlyIn: receiptBook.
	! !
!CheckOutTest methodsFor: 'assertions' stamp: 'AW 6/14/2021 21:59:15'!
                            assert: anItem isTheOnlyIn: aCollection

	self assert: aCollection size equals: 1.
	self assert: aCollection includes: anItem! !
!CheckOutTest methodsFor: 'card validation' stamp: 'nz 6/16/2021 00:42:38'!
                   test05CheckoutWithExpiredCardShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor .
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: expiredCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckWithExpiredCardErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'card validation' stamp: 'nz 6/16/2021 00:45:20'!
                            test06CheckoutWithCardExpiredThisMonthShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: expiredThisMonthCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckWithExpiredCardErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'card validation' stamp: 'nz 6/16/2021 00:48:37'!
           test10CheckoutWithInvalidCardNumberShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: invalidNumberCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier invalidCreditCardNumberErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'card validation' stamp: 'nz 6/16/2021 00:50:15'!
                  test11CheckoutWithEmptyCardOwnerNameShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: emptyOwnerCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier invalidCreditCardOwnerNameErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'card validation' stamp: 'nz 6/16/2021 00:50:50'!
                 test12CheckoutWithBlankCardOwnerNameShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: emptyOwnerCreditCard2 on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier invalidCreditCardOwnerNameErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'shopping cart validation' stamp: 'nz 6/16/2021 00:46:51'!
       test01CheckoutEmptyCartShouldRaiseError

	| aCashier bookPrices cart  receiptBook |
	
	bookPrices _ PriceList new.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor .
	
	cart _ ShoppingCart new.
	
	self should: [ aCashier checkOut: cart payingWith: validCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckoutEmptyCartErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'shopping cart validation' stamp: 'nz 6/16/2021 00:42:03'!
                       test04CheckoutItemWithoutPricesShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysOkMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: validCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckoutItemWithNoPriceForItErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'setUp/tearDown' stamp: 'AW 6/24/2021 00:23:52' overrides: 16927572!
      setUp

	today _ FixedGregorianDate today.
	currentMonth _ today monthOfYear.
	
	creditCardNumber _ '4182418241824182'.
	cardOwner _ 'PEPE SANCHEZ'.

	stubs := TestStubs new.

	validCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth next.
	
	expiredCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth previous.
		
	expiredThisMonthCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth.
		
	invalidNumberCreditCard _ stubs invalidNumberCreditCard.
		
	emptyOwnerCreditCard _ CreditCard
		number: creditCardNumber
		owner: ''
		expiration: currentMonth next.
		
	emptyOwnerCreditCard2 _ CreditCard
		number: creditCardNumber
		owner: '            '
		expiration: currentMonth next.
		
	book1 := stubs book1.
	book2 := stubs book2.
	
	mockAlwaysStolenCardMerchantProcessor _ MockAlwaysStolenCardMerchantProcessor new.
	mockAlwaysOkMerchantProcessor _ stubs mockAlwaysOkMerchantProcessor: stubs timeProvider.
	mockAlwaysFakeCardMerchantProcessor _ MockAlwaysFakeCardMerchantProcessor new.
	mockAlwaysWithoutCreditCardMerchantProcessor _ MockAlwaysWithoutCreditCardMerchantProcessor new.! !
!CheckOutTest methodsFor: 'merchant processor' stamp: 'nz 6/16/2021 00:46:43'!
              test07CheckoutWithStolenCardShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysStolenCardMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: validCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: MerchantProcessor stolenCreditCardErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'merchant processor' stamp: 'nz 6/16/2021 00:47:45'!
                   test08CheckoutWithFakeCardShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysFakeCardMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: validCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: MerchantProcessor fakeCreditCardErrorDescription.
		
	self assert: receiptBook isEmpty.! !
!CheckOutTest methodsFor: 'merchant processor' stamp: 'nz 6/16/2021 00:47:36'!
                         test09CheckoutWithInsufficientFundsShouldRaiseError

	| aCashier bookPrices cart receiptBook |
	
	bookPrices _ PriceList new.
	bookPrices set: book1 price: 50.
	
	receiptBook _ OrderedCollection new.
	
	aCashier _ Cashier withPrices: bookPrices receiptBook: receiptBook merchantProcessor: mockAlwaysWithoutCreditCardMerchantProcessor.
	
	cart _ ShoppingCart new.
	cart add: 3 of: book1.
	
	self should: [ aCashier checkOut: cart payingWith: validCreditCard on: today. ]
		raise: Error - MessageNotUnderstood
		withMessageText: MerchantProcessor insufficientFundsCreditCardErrorDescription.
		
	self assert: receiptBook isEmpty.! !

TestCase subclass: #PriceListTest
	instanceVariableNames: 'book1 book2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #PriceListTest category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:15'!
TestCase subclass: #PriceListTest
	instanceVariableNames: 'book1 book2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!PriceListTest methodsFor: 'price validation' stamp: 'nz 6/16/2021 01:25:23'!
   test01AddItemWithNegativePriceShouldRaiseError

	| priceList |
	
	priceList _ PriceList new.
	
	self should: [ priceList set: book1 price: -100.]
		raise: Error - MessageNotUnderstood
		withMessageText: PriceList itemPriceMustBePositiveErrorDescription.! !
!PriceListTest methodsFor: 'price validation' stamp: 'nz 6/16/2021 01:25:37'!
                 test02AddItemWithZeroPriceShouldRaiseError

	| priceList |
	
	priceList _ PriceList new.
	
	self should: [ priceList set: book1 price: 0.]
		raise: Error - MessageNotUnderstood
		withMessageText: PriceList itemPriceMustBePositiveErrorDescription.! !
!PriceListTest methodsFor: 'setUp/tearDown' stamp: 'nz 6/16/2021 01:15:07' overrides: 16927572!
      setUp
	
	book1 := 'ISBN1'.
	book2 := 'ISBN2'.! !

TestCase subclass: #ShopTest
	instanceVariableNames: 'creditCard1 stubs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShopTest category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:15'!
TestCase subclass: #ShopTest
	instanceVariableNames: 'creditCard1 stubs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/24/2021 01:32:59'!
        test01InvalidClientShallNotPass
	
	| shop |
	
	shop := Shop
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: false) 
		prices: stubs priceList
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	self should: [ shop createCartClientId: 3 password: '123'. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Shop incorrectPasswordOrClientIdErrorDescription.	
	
	! !
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/24/2021 01:37:38'!
                              test02NewCartsAreEmpty
	
	| shop cartId cartItems |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems isEmpty.! !
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/24/2021 01:38:17'!
 test03ListCartWithOneItem
	
	| shop cartId cartItems bookIsbn quantity |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems size equals: 1.
	self assert: cartItems first quantity equals: quantity.
	self assert: cartItems first item equals: bookIsbn.! !
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/24/2021 01:38:40'!
                           test04ListInvalidCartShouldRaiseError
	
	| shop |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
	
	self should: [ shop listCart: 15 ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Shop invalidCartIdErrorDescription.
	! !
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/24/2021 01:39:39'!
             test05AddItemToCartDoesntModifyOtherCarts
	
	| shop bookIsbn cartId1 cartId2 quantity |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
	
	cartId1 := shop createCartClientId: 3 password: '1234'.
	cartId2 := shop createCartClientId: 4 password: '12345'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId1.
	
	self assert: (shop listCart: cartId2) isEmpty.
	! !
!ShopTest methodsFor: 'cart expiration' stamp: 'nz 6/24/2021 16:25:02'!
                 test14CheckingOutAnExpiredCardShouldFail
	
	| shop cartId password clientId timeProvider |
	
	timeProvider := stubs timeProvider.
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: timeProvider.
		
	clientId := 15.
	password := '123456'.
	
	cartId := shop createCartClientId: clientId password: password.
	
	timeProvider toTheFuture: 31 * minute.
	
	self should: [ shop checkOut: cartId payingWith: stubs validCreditCard ]
		raise: Error - MessageNotUnderstood
		withMessageText: Shop expiredCartErrorDescription.
	
	! !
!ShopTest methodsFor: 'cart expiration' stamp: 'nz 6/24/2021 16:27:57'!
      test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended
	
	| shop cartId password clientId timeProvider |
	
	timeProvider := stubs timeProvider.
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: timeProvider.
		
	clientId := 15.
	password := '123456'.
	
	timeProvider toTheFuture: 31 * minute.
	
	cartId := shop createCartClientId: clientId password: password.
		
	self should: [ shop checkOut: cartId payingWith: stubs validCreditCard ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckoutEmptyCartErrorDescription.
	
	! !
!ShopTest methodsFor: 'cart expiration' stamp: 'nz 6/24/2021 16:28:15'!
    test16AddingItemsToAnExpiredCartShouldFail
	
	| shop cartId password clientId timeProvider |
	
	timeProvider := stubs timeProvider.
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: timeProvider.
		
	clientId := 15.
	password := '123456'.
	
	cartId := shop createCartClientId: clientId password: password.
	
	timeProvider toTheFuture: 31 * minute.
	
	self should: [ shop add: 12 of: stubs book1 to: cartId ]
		raise: Error - MessageNotUnderstood
		withMessageText: Shop expiredCartErrorDescription.
	
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'AW 6/24/2021 01:40:21'!
     test06CheckoutInvalidCartIdShouldRaiseError
	
	| shop |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
	
	self should: [ shop checkOut: 16 payingWith: creditCard1 ]
		raise: Error - MessageNotUnderstood
		withMessageText: Shop invalidCartIdErrorDescription.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'AW 6/24/2021 01:40:45'!
           test07CheckoutUsesTheCashier
	
	| shop cartId |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 15 password: '1234'.
	
	self should: [ shop checkOut: cartId payingWith: stubs validCreditCard ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier cantCheckoutEmptyCartErrorDescription.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'AW 6/24/2021 01:43:21'!
                               test08ListPurchasesOnOnlyOneBuyClient
	
	| shop cartId clientId password purchases |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	cartId := shop createCartClientId: clientId password: password.
	
	shop add: 2 of: stubs book1 to: cartId.
	
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	purchases := shop listPurchasesOf: clientId with: password.
	self assert: purchases total equals: 100.
	self assert: purchases items size equals: 2.
	self assert: (purchases items occurrencesOf: stubs book1) equals: 2.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'nz 6/24/2021 16:21:59'!
                        test09ListPurchasesOfManyItemsByOneClient
	
	| shop cartId clientId password purchases |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	cartId := shop createCartClientId: clientId password: password.
	
	shop add: 2 of: stubs book1 to: cartId.
	
	shop add: 1 of: stubs book2 to: cartId.
	
	shop add: 1 of: stubs book3 to: cartId.
	
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	purchases := shop listPurchasesOf: clientId with: password.
	self assert: purchases total equals: 150.
	self assert: purchases items size equals: 4.
	self assert: (purchases items occurrencesOf: stubs book1) equals: 2.
	self assert: (purchases items occurrencesOf: stubs book2) equals: 1.
	self assert: (purchases items occurrencesOf: stubs book3) equals: 1.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'nz 6/24/2021 16:22:34'!
                  test10CheckoutWithInvalidCreditCardShouldFail
	
	| shop cartId clientId password |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	cartId := shop createCartClientId: clientId password: password.
	
	shop add: 1 of: stubs book1 to: cartId.
	
	self
		should: [ shop
				checkOut: cartId
				payingWith: stubs invalidNumberCreditCard. ]
		raise: Error - MessageNotUnderstood
		withMessageText: Cashier invalidCreditCardNumberErrorDescription.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'nz 6/24/2021 16:23:14'!
           test11ListMultiplePurchasesOfTheSameClient
	
	| shop cartId clientId password purchases cartId2 |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	
	cartId := shop createCartClientId: clientId password: password.
	shop add: 2 of: stubs book1 to: cartId.
	shop add: 1 of: stubs book2 to: cartId.
	shop add: 1 of: stubs book3 to: cartId.
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	cartId2 := shop createCartClientId: clientId password: password.
	shop add: 1 of: stubs book1 to: cartId2.
	shop add: 1 of: stubs book3 to: cartId2.
	shop checkOut: cartId2 payingWith: stubs validCreditCard.
	
	purchases := shop listPurchasesOf: clientId with: password.
	self assert: 230 equals: purchases total.
	self assert: 6 equals: purchases items size.
	self assert: (purchases items occurrencesOf: stubs book1) equals: 3.
	self assert: (purchases items occurrencesOf: stubs book2) equals: 1.
	self assert: (purchases items occurrencesOf: stubs book3) equals: 2.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'nz 6/24/2021 16:23:52'!
                            test12ListPurchasesOfIncorrectPasswordShouldFail
	
	| shop clientId password |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: false) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	
	self should: [ shop listPurchasesOf: clientId with: password ] 
		raise: Error - MessageNotUnderstood 
		withMessageText: Shop incorrectPasswordOrClientIdErrorDescription.
	! !
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'nz 6/24/2021 16:24:14'!
                    test13ListPurchasesOfDifferentClients
	
	| shop cartId clientId1 clientId2 password client1purchases cartId2 client2purchases |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId1 := 15.
	clientId2 := 42.
	password := '123456'.
	
	cartId := shop createCartClientId: clientId1 password: password.
	shop add: 2 of: stubs book1 to: cartId.
	shop add: 1 of: stubs book2 to: cartId.
	shop add: 1 of: stubs book3 to: cartId.
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	cartId2 := shop createCartClientId: clientId2 password: password.
	shop add: 1 of: stubs book1 to: cartId2.
	shop add: 1 of: stubs book3 to: cartId2.
	shop checkOut: cartId2 payingWith: stubs validCreditCard.
	
	client1purchases := shop listPurchasesOf: clientId1 with: password.
	self assert: 150 equals: client1purchases total.
	self assert: 4 equals: client1purchases items size.
	
	client2purchases := shop listPurchasesOf: clientId2 with: password.
	self assert: 80 equals: client2purchases total.
	self assert: 2 equals: client2purchases items size.
	! !
!ShopTest methodsFor: 'setUp/tearDown' stamp: 'nz 6/23/2021 00:46:42' overrides: 16927572!
                    setUp

	stubs := TestStubs new.! !

TestCase subclass: #ShoppingCartTest
	instanceVariableNames: 'book1 book2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShoppingCartTest category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:16'!
TestCase subclass: #ShoppingCartTest
	instanceVariableNames: 'book1 book2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!ShoppingCartTest methodsFor: 'quantity errors' stamp: 'AW 6/14/2021 22:06:29'!
            test04AddingANegativeQuantityRaisesError
	| shoppingCart |

	shoppingCart := ShoppingCart new.
	
	self  should: [ shoppingCart add: -2 of: book1. ]
		raise: Error - MessageNotUnderstood 
		withMessageText: ShoppingCart itemQuantityMustBeGreaterThanZeroErrorDescription.
	! !
!ShoppingCartTest methodsFor: 'quantity errors' stamp: 'AW 6/14/2021 22:06:35'!
                             test05AddingZeroQuantityRaisesError
	| shoppingCart |

	shoppingCart := ShoppingCart new.
	
	self  should: [ shoppingCart add: 0 of: book1. ]
		raise: Error - MessageNotUnderstood 
		withMessageText: ShoppingCart itemQuantityMustBeGreaterThanZeroErrorDescription.
	! !
!ShoppingCartTest methodsFor: 'quantity errors' stamp: 'AW 6/14/2021 22:08:22'!
   test06AddingNonIntegerQuantityRaisesError
	| shoppingCart |

	shoppingCart := ShoppingCart new.
	
	self  should: [ shoppingCart add: 1.5 of: book1. ]
		raise: Error - MessageNotUnderstood 
		withMessageText: ShoppingCart itemQuantyMustBeAnIntegerErrorDescription.
	! !
!ShoppingCartTest methodsFor: 'assertions' stamp: 'nz 6/14/2021 19:02:37'!
        assert: shoppingCart has: quantity of: item

	self assert: (shoppingCart entries anySatisfy: [ :anShoppingCartItem | 
		anShoppingCartItem is: quantity of: item.
	] ).! !
!ShoppingCartTest methodsFor: 'adding items' stamp: 'nz 6/14/2021 19:02:37'!
        test01EmptyCartHasNoItems

	| shoppingCart |
	shoppingCart := ShoppingCart new.
	
	self assert: shoppingCart entries size equals: 0. ! !
!ShoppingCartTest methodsFor: 'adding items' stamp: 'nz 6/14/2021 19:02:37'!
          test02AddingAnItemToACart
	| shoppingCart quantity |

	shoppingCart := ShoppingCart new.
	quantity := 1.
	
	shoppingCart add: quantity of: book1.
	
	self assert: shoppingCart entries size equals: 1.
	self assert: shoppingCart has: quantity of: book1.! !
!ShoppingCartTest methodsFor: 'adding items' stamp: 'nz 6/14/2021 19:02:37'!
                     test03AddingMultipleItemsToACart
	| shoppingCart |

	shoppingCart := ShoppingCart new.
	
	shoppingCart add: 1 of: book1.
	shoppingCart add: 2 of: book2.
	
	self assert: shoppingCart entries size equals: 2.
	self assert: shoppingCart has: 1 of: book1.
	self assert: shoppingCart has: 2 of: book2.! !
!ShoppingCartTest methodsFor: 'setUp/tearDown' stamp: 'nz 6/16/2021 00:52:20' overrides: 16927572!
                  setUp
	
	book1 := 'ISBN1'.
	book2 := 'ISBN2'.! !

Object subclass: #Cashier
	instanceVariableNames: 'priceList receiptBook merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #Cashier category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:16'!
Object subclass: #Cashier
	instanceVariableNames: 'priceList receiptBook merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!Cashier methodsFor: 'initialization' stamp: 'AW 6/15/2021 23:05:59'!
               initializePrices: aPriceList receiptBook: aReceiptBook merchantProcessor: aMerchantProcessor  
	
	priceList := aPriceList.
	receiptBook := aReceiptBook.
	merchantProcessor := aMerchantProcessor.! !
!Cashier methodsFor: 'private' stamp: 'nz 6/15/2021 23:47:15'!
                           calculateShoppingCartTotal: aShoppingCart

	^ aShoppingCart entries sum: [ :entry |
		self priceFor: entry.
	] ifEmpty: [
		self error: self class cantCheckoutEmptyCartErrorDescription .
	]! !
!Cashier methodsFor: 'private' stamp: 'nz 6/23/2021 01:34:27'!
createReceiptWithTotal: anAmountOfMoney cart: aShoppingCart 

	| receipt |
	
	receipt _ Receipt withTotal: anAmountOfMoney items: (self getEntriesAsBag: aShoppingCart).
	receiptBook add: receipt.
	
	^receipt .! !
!Cashier methodsFor: 'private' stamp: 'nz 6/23/2021 01:37:45'!
            getEntriesAsBag: aShoppingCart 
	
	| aBag |
	aBag := Bag new.
	
	aShoppingCart entries do: [ :entry | aBag add: entry item withOccurrences: entry quantity ].
	
	^aBag.! !
!Cashier methodsFor: 'private' stamp: 'nz 6/14/2021 18:55:26'!
                      priceFor: aShoppingCartEntry
	
	^(priceList priceFor: aShoppingCartEntry item) * (aShoppingCartEntry quantity).! !
!Cashier methodsFor: 'checkout' stamp: 'nz 6/23/2021 01:31:18'!
             checkOut: aShoppingCart payingWith: aCreditCard on: aGregorianDate  

	| total |

	self assertCanCheckout: aShoppingCart payingWith: aCreditCard on: aGregorianDate.
	
	total _ self calculateShoppingCartTotal: aShoppingCart.

	merchantProcessor debit: total from: aCreditCard. 

	^ self createReceiptWithTotal: total cart: aShoppingCart.
	! !
!Cashier methodsFor: 'validation' stamp: 'nz 6/14/2021 19:30:27'!
        areAllItemsInPriceList: aCollectionOfShoppingCartEntries

	^ aCollectionOfShoppingCartEntries allSatisfy: [ :entry | priceList hasPriceFor: entry item ]! !
!Cashier methodsFor: 'validation' stamp: 'nz 6/14/2021 19:30:27'!
  assertAllItemsInPriceList: aCollectionOfShoppingCartEntries

	(self areAllItemsInPriceList: aCollectionOfShoppingCartEntries)
		ifFalse: [ self error: self class cantCheckoutItemWithNoPriceForItErrorDescription ]
	
	! !
!Cashier methodsFor: 'validation' stamp: 'nz 6/16/2021 00:12:02'!
  assertCanCheckout: aShoppingCart payingWith: aCreditCard on: aGregorianDate

	self assertAllItemsInPriceList: aShoppingCart entries.
	self assertCardIsValid: aCreditCard on: aGregorianDate.! !
!Cashier methodsFor: 'validation' stamp: 'nz 6/16/2021 00:21:41'!
                             assertCardIsValid: aCreditCard on: aGregorianDate 
	
	(aCreditCard isExpiredOn: aGregorianDate) ifTrue: [
		self error: self class cantCheckWithExpiredCardErrorDescription.	
	].
	aCreditCard hasValidNumber ifFalse: [
		self error: self class invalidCreditCardNumberErrorDescription.	
	].
	aCreditCard hasValidOwnerName ifFalse: [
		self error: self class invalidCreditCardOwnerNameErrorDescription.	
	].! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

Cashier class
	instanceVariableNames: ''!

!classDefinition: 'Cashier class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Cashier class
	instanceVariableNames: ''!
!Cashier class methodsFor: 'instance creation' stamp: 'AW 6/15/2021 23:06:29'!
                withPrices: aPriceList receiptBook: aReceiptBook merchantProcessor: aMerchantProcessor  
	^self new initializePrices: aPriceList receiptBook: aReceiptBook merchantProcessor: aMerchantProcessor ! !
!Cashier class methodsFor: 'errors' stamp: 'AW 6/14/2021 22:11:12'!
                       cantCheckWithExpiredCardErrorDescription
	^'The card is expired!!'! !
!Cashier class methodsFor: 'errors' stamp: 'nz 6/10/2021 00:21:44'!
                      cantCheckoutEmptyCartErrorDescription
	^'Cannot checkout an empty shopping cart!!'.! !
!Cashier class methodsFor: 'errors' stamp: 'nz 6/14/2021 19:17:37'!
     cantCheckoutItemWithNoPriceForItErrorDescription
	^'Cant checkout item with no price for it!!'.! !
!Cashier class methodsFor: 'errors' stamp: 'nz 6/15/2021 23:55:55'!
                         invalidCreditCardNumberErrorDescription
	^'The credit card number is invalid!!'.! !
!Cashier class methodsFor: 'errors' stamp: 'nz 6/16/2021 00:21:09'!
        invalidCreditCardOwnerNameErrorDescription
	^'Invalid credit card owner name!!'.! !

Object subclass: #CreditCard
	instanceVariableNames: 'number owner expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #CreditCard category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #CreditCard
	instanceVariableNames: 'number owner expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!CreditCard methodsFor: 'initialization' stamp: 'nz 6/10/2021 00:21:00'!
initializeNumber: aCreditCardNumber owner: anOwnerName expiration: anExpirationMonthOfYear 

	number := aCreditCardNumber.
	owner := anOwnerName.
	expiration := anExpirationMonthOfYear.! !
!CreditCard methodsFor: 'validations' stamp: 'nz 6/16/2021 00:17:53'!
                             hasValidNumber
	^number size = 16.! !
!CreditCard methodsFor: 'validations' stamp: 'nz 6/16/2021 00:32:49'!
                    hasValidOwnerName
	^owner withBlanksTrimmed isEmpty not.! !
!CreditCard methodsFor: 'validations' stamp: 'AW 6/14/2021 23:03:42'!
                              isExpiredOn: aGregorianDate 
	
	^expiration <= aGregorianDate monthOfYear.! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

CreditCard class
	instanceVariableNames: ''!

!classDefinition: 'CreditCard class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
CreditCard class
	instanceVariableNames: ''!
!CreditCard class methodsFor: 'instance creation' stamp: 'nz 6/10/2021 00:20:07'!
             number: aCreditCardNumber owner: anOwnerName expiration: anExpirationMonthOfYear 

	^self new initializeNumber: aCreditCardNumber owner: anOwnerName expiration: anExpirationMonthOfYear ! !

Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MerchantProcessor category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MerchantProcessor methodsFor: 'debit' stamp: 'AW 6/15/2021 23:11:55'!
                  debit: anAmountOfMoney from: aCreditCard
	
	self subclassResponsibility.! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

MerchantProcessor class
	instanceVariableNames: ''!

!classDefinition: 'MerchantProcessor class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MerchantProcessor class
	instanceVariableNames: ''!
!MerchantProcessor class methodsFor: 'errors' stamp: 'AW 6/15/2021 23:15:42'!
                              fakeCreditCardErrorDescription
	^'Cannot debit from a fake card!!'.! !
!MerchantProcessor class methodsFor: 'errors' stamp: 'nz 6/16/2021 01:04:01'!
           insufficientFundsCreditCardErrorDescription
	^'Cannot debit from a credit card with insufficient funds!!'.! !
!MerchantProcessor class methodsFor: 'errors' stamp: 'nz 6/16/2021 01:04:04'!
    stolenCreditCardErrorDescription
	^'Cannot debit from stolen credit card!!'.! !

MerchantProcessor subclass: #MockAlwaysFakeCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockAlwaysFakeCardMerchantProcessor category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MerchantProcessor subclass: #MockAlwaysFakeCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockAlwaysFakeCardMerchantProcessor methodsFor: 'debit' stamp: 'AW 6/15/2021 23:16:20' overrides: 50332734!
             debit: anAmountOfMoney from: aCreditCard 
	
	^self error: self class fakeCreditCardErrorDescription .! !

MerchantProcessor subclass: #MockAlwaysOkMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockAlwaysOkMerchantProcessor category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MerchantProcessor subclass: #MockAlwaysOkMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockAlwaysOkMerchantProcessor methodsFor: 'debit' stamp: 'AW 6/15/2021 23:10:31' overrides: 50332734!
            debit: anAmountOfMoney from: aCreditCard ! !

MerchantProcessor subclass: #MockAlwaysStolenCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockAlwaysStolenCardMerchantProcessor category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MerchantProcessor subclass: #MockAlwaysStolenCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockAlwaysStolenCardMerchantProcessor methodsFor: 'debit' stamp: 'AW 6/15/2021 23:07:32' overrides: 50332734!
        debit: anAmountOfMoney from: aCreditCard 
	
	^self error: self class stolenCreditCardErrorDescription.! !

MerchantProcessor subclass: #MockAlwaysWithoutCreditCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockAlwaysWithoutCreditCardMerchantProcessor category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MerchantProcessor subclass: #MockAlwaysWithoutCreditCardMerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockAlwaysWithoutCreditCardMerchantProcessor methodsFor: 'debit' stamp: 'AW 6/15/2021 23:30:15' overrides: 50332734!
               debit: anAmountOfMoney from: aCreditCard 
	
	^self error: self class insufficientFundsCreditCardErrorDescription .! !

Object subclass: #MockTimeProvider
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockTimeProvider category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #MockTimeProvider
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockTimeProvider methodsFor: 'time traveling' stamp: 'AW 6/24/2021 00:57:56'!
              toTheFuture: anAmountOfFuture
	now := now next: anAmountOfFuture.! !
!MockTimeProvider methodsFor: 'accessing time' stamp: 'AW 6/24/2021 00:59:41'!
            now
	^now.! !
!MockTimeProvider methodsFor: 'initialization' stamp: 'AW 6/24/2021 00:59:25' overrides: 16896425!
               initialize

	now := GregorianDateTime now.! !

Object subclass: #MockUserAuthenticator
	instanceVariableNames: 'authenticationResponse'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #MockUserAuthenticator category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #MockUserAuthenticator
	instanceVariableNames: 'authenticationResponse'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!MockUserAuthenticator methodsFor: 'initialization' stamp: 'nz 6/17/2021 21:25:35'!
                            initializeAlwaysReturning: anAuthenticationResponse 
	
	authenticationResponse := anAuthenticationResponse.! !
!MockUserAuthenticator methodsFor: 'as yet unclassified' stamp: 'nz 6/17/2021 21:31:32'!
                        authenticate: aSmallInteger password: aString 
	^authenticationResponse .! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

MockUserAuthenticator class
	instanceVariableNames: ''!

!classDefinition: 'MockUserAuthenticator class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
MockUserAuthenticator class
	instanceVariableNames: ''!
!MockUserAuthenticator class methodsFor: 'instance creation' stamp: 'nz 6/17/2021 21:26:42'!
  alwaysReturning: anAuthenticationResponse
	^self new initializeAlwaysReturning: anAuthenticationResponse ! !

Object subclass: #PriceList
	instanceVariableNames: 'prices'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #PriceList category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #PriceList
	instanceVariableNames: 'prices'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!PriceList methodsFor: 'initialization' stamp: 'nz 6/14/2021 18:59:05' overrides: 16896425!
                         initialize

	prices _ Dictionary new.! !
!PriceList methodsFor: 'accessing' stamp: 'nz 6/14/2021 19:29:04'!
                    hasPriceFor: aBook 
	
	^prices includesKey: aBook.! !
!PriceList methodsFor: 'accessing' stamp: 'nz 6/14/2021 19:00:48'!
       priceFor: aBook 
	
	^prices at: aBook.! !
!PriceList methodsFor: 'set prices' stamp: 'nz 6/16/2021 01:24:12'!
                  set: aBook price: aPrice 
	self assertPriceIsValid: aPrice.
	prices at: aBook put: aPrice.! !
!PriceList methodsFor: 'validation' stamp: 'nz 6/16/2021 01:24:12'!
                              assertPriceIsValid: aPrice

	^ (aPrice > 0) ifFalse: [ self error: self class itemPriceMustBePositiveErrorDescription. ]! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

PriceList class
	instanceVariableNames: ''!

!classDefinition: 'PriceList class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
PriceList class
	instanceVariableNames: ''!
!PriceList class methodsFor: 'errors' stamp: 'nz 6/16/2021 01:21:09'!
              itemPriceMustBePositiveErrorDescription
	^'Item price must be positive!!'.! !

Object subclass: #PurchasesSummary
	instanceVariableNames: 'items total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #PurchasesSummary category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #PurchasesSummary
	instanceVariableNames: 'items total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!PurchasesSummary methodsFor: 'accessing' stamp: 'nz 6/23/2021 00:25:00'!
           items
	^ items. ! !
!PurchasesSummary methodsFor: 'accessing' stamp: 'nz 6/23/2021 00:24:54'!
  total
	^total.! !
!PurchasesSummary methodsFor: 'initialization' stamp: 'AW 6/23/2021 23:14:32'!
                               initializeFor: aReceiptCollection

	total := 0.
	items := Bag new.
	aReceiptCollection do: [ :aReceipt | 
		items addAll: aReceipt items.
		total := total + aReceipt total.	
	].
	! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

PurchasesSummary class
	instanceVariableNames: ''!

!classDefinition: 'PurchasesSummary class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
PurchasesSummary class
	instanceVariableNames: ''!
!PurchasesSummary class methodsFor: 'instance creation' stamp: 'AW 6/23/2021 23:08:11'!
            for: aReceiptCollection

	^self new initializeFor: aReceiptCollection.! !

Object subclass: #Receipt
	instanceVariableNames: 'total items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #Receipt category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #Receipt
	instanceVariableNames: 'total items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!Receipt methodsFor: 'initialization' stamp: 'nz 6/23/2021 01:40:10'!
              initializeWithTotal: aTransactionTotal items: aBagOfItems  
	
	total := aTransactionTotal.
	items := aBagOfItems.! !
!Receipt methodsFor: 'accessing' stamp: 'nz 6/23/2021 01:40:20'!
          items
	^items.! !
!Receipt methodsFor: 'accessing' stamp: 'nz 6/14/2021 18:49:08'!
             total
	^total.! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

Receipt class
	instanceVariableNames: ''!

!classDefinition: 'Receipt class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Receipt class
	instanceVariableNames: ''!
!Receipt class methodsFor: 'instance creation' stamp: 'nz 6/23/2021 01:39:45'!
                     withTotal: aTransactionTotal items: aBagOfItems  

	^self new initializeWithTotal: aTransactionTotal items: aBagOfItems ! !

Object subclass: #Shop
	instanceVariableNames: 'userAuthenticator carts clientReceipts cashier cartsClients timeProvider cartCreationTimes'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #Shop category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #Shop
	instanceVariableNames: 'userAuthenticator carts clientReceipts cashier cartsClients timeProvider cartCreationTimes'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!Shop methodsFor: 'facade' stamp: 'AW 6/23/2021 23:34:42'!
                  add: aQuantity of: anItem to: aShoppingCartId
	
	(self getCart: aShoppingCartId) add: aQuantity of: anItem! !
!Shop methodsFor: 'facade' stamp: 'nz 6/24/2021 16:38:48'!
                       checkOut: aShoppingCartId payingWith: aCreditCard 
	"
	Acá quedo expuesta la clase de la tarjeta de credito.
	"
	
	| cart clientId receipt |
	
	cart := self getCart: aShoppingCartId. 
	clientId := self getClientIdOf: aShoppingCartId.
	
	receipt := cashier checkOut: cart payingWith: aCreditCard on: self today.
	
	self registerReceipt: receipt for: clientId.
! !
!Shop methodsFor: 'facade' stamp: 'AW 6/24/2021 00:11:58'!
                          createCartClientId: aClientId password: aPassword

	self authenticateClient: aClientId withPassword: aPassword.

	^self createCartAndGetIdFor: aClientId.! !
!Shop methodsFor: 'facade' stamp: 'nz 6/24/2021 16:39:35'!
        listCart: aShoppingCartId 
	"
	Aca nos quedo expuesta la clase ShoppingCartEntry
	Despues de definir PurchasesSummary pensamos en
	refactorizar el carrito para que use una Bag pero
	no llegamos con ese refactor.
	"
	(self cartExists: aShoppingCartId) ifTrue: [ self error: self class invalidCartIdErrorDescription ]. 
 	
	^self getCartEntries: aShoppingCartId.! !
!Shop methodsFor: 'facade' stamp: 'AW 6/23/2021 23:42:03'!
                         listPurchasesOf: aClientId with: aClientPassword
	
	self authenticateClient: aClientId withPassword: aClientPassword.
	
	^ PurchasesSummary for: (self receiptsFor: aClientId).! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/24/2021 00:01:59'!
        assertCartExists: aShoppingCartId
	
	(self cartExists: aShoppingCartId ) 
		ifTrue: [ self error: self class invalidCartIdErrorDescription ].
! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/22/2021 22:06:13'!
         cartExists: aShoppingCartId

	^ carts size < aShoppingCartId! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/24/2021 01:22:56'!
                           createCartAndGetIdFor: aClientId
	| cartId |
	carts add: ShoppingCart new.
	
	cartId := carts size.
	
	cartsClients at: cartId put: aClientId. 
	cartCreationTimes at: cartId put: timeProvider now.
	
	^ cartId.! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/24/2021 01:28:40'!
      getCart: aShoppingCartId

	self assertCartExists: aShoppingCartId.
	self assertCartIsNotExpired: aShoppingCartId.
	
	^ carts at: aShoppingCartId! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/22/2021 22:00:46'!
       getCartEntries: aShoppingCartId

	^ (self getCart: aShoppingCartId) entries! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/24/2021 00:08:15'!
            getClientIdOf: aCartId 
	
	^cartsClients at: aCartId .! !
!Shop methodsFor: 'cart expiration' stamp: 'AW 6/24/2021 01:17:04'!
  assertCartIsNotExpired: aCartId 
	| cartAge |
	cartAge := self getCartAgeFor: aCartId. 
	(cartAge > self maxCartAge) 
		ifTrue: [ self error: self class expiredCartErrorDescription ].! !
!Shop methodsFor: 'cart expiration' stamp: 'AW 6/24/2021 01:15:39'!
 getCartAgeFor: aCartId
	| cartCreationTime now |
	
	cartCreationTime := self getCreationTime: aCartId.
	now := timeProvider now.
	
	^cartCreationTime distanceTo: now.! !
!Shop methodsFor: 'cart expiration' stamp: 'AW 6/24/2021 01:21:52'!
                  getCreationTime: aCartId 
	^cartCreationTimes at: aCartId.! !
!Shop methodsFor: 'cart expiration' stamp: 'AW 6/24/2021 01:13:32'!
                              maxCartAge

	^ 30 * minute! !
!Shop methodsFor: 'client receipts' stamp: 'AW 6/23/2021 23:41:33'!
                              receiptsFor: aClientId

	^ clientReceipts at: aClientId! !
!Shop methodsFor: 'client receipts' stamp: 'AW 6/23/2021 23:04:08'!
 registerReceipt: aReceipt for: aClientId 
	| receipts |
	receipts := clientReceipts at: aClientId ifAbsentPut: OrderedCollection new.
	
	receipts add: aReceipt.! !
!Shop methodsFor: 'time provider' stamp: 'nz 6/23/2021 01:11:36'!
                          today
	^FixedGregorianDate today.! !
!Shop methodsFor: 'initialization' stamp: 'AW 6/24/2021 01:22:19'!
                        initializeWithUserAuthenticator: anUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider    
	
	userAuthenticator := anUserAuthenticator.
	carts := OrderedCollection new.
	clientReceipts  := Dictionary new. 
	cartsClients := Dictionary new. 
	cartCreationTimes := Dictionary new. 
	timeProvider := aTimeProvider.		
	cashier := Cashier
		withPrices: aPriceList
		receiptBook: OrderedCollection new
		merchantProcessor: aMerchantProcessor.
		

		
	
		

		! !
!Shop methodsFor: 'user authentication' stamp: 'AW 6/23/2021 23:40:21'!
                              authenticateClient: aClientId withPassword: aPassword
	
	(userAuthenticator authenticate: aClientId password: aPassword) ifFalse: [
		self error: self class incorrectPasswordOrClientIdErrorDescription .
	]! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

Shop class
	instanceVariableNames: ''!

!classDefinition: 'Shop class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Shop class
	instanceVariableNames: ''!
!Shop class methodsFor: 'errors' stamp: 'AW 6/24/2021 00:38:25'!
             expiredCartErrorDescription
	^'The cart is expired!!'.! !
!Shop class methodsFor: 'errors' stamp: 'nz 6/17/2021 21:10:15'!
     incorrectPasswordOrClientIdErrorDescription
	^'Incorrect password or client id!!'.! !
!Shop class methodsFor: 'errors' stamp: 'AW 6/22/2021 21:33:52'!
         invalidCartIdErrorDescription
	^'The cart id is invalid!!'! !
!Shop class methodsFor: 'instance creation' stamp: 'AW 6/24/2021 00:50:00'!
                      withUserAuthenticator: anUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider    

	^self new initializeWithUserAuthenticator: anUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider ! !

Object subclass: #ShoppingCart
	instanceVariableNames: 'entries'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShoppingCart category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #ShoppingCart
	instanceVariableNames: 'entries'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!ShoppingCart methodsFor: 'accessing' stamp: 'nz 6/14/2021 19:02:37'!
                   entries
	^entries.! !
!ShoppingCart methodsFor: 'adding' stamp: 'nz 6/14/2021 19:42:41'!
       add: aQuantity of: anItem 

	self assertQuantityIsValid: aQuantity.
	
	entries add: (ShoppingCartEntry for: anItem quantity: aQuantity).! !
!ShoppingCart methodsFor: 'validations' stamp: 'AW 6/10/2021 20:09:49'!
            assertQuantityIsValid: aQuantity

	aQuantity strictlyPositive
		ifFalse: [ self error: self class itemQuantityMustBeGreaterThanZeroErrorDescription ].
	
	aQuantity isInteger
		ifFalse: [ self error: self class itemQuantyMustBeAnIntegerErrorDescription ]! !
!ShoppingCart methodsFor: 'initialization' stamp: 'nz 6/14/2021 19:42:36' overrides: 16896425!
initialize

	entries := OrderedCollection new.! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

ShoppingCart class
	instanceVariableNames: ''!

!classDefinition: 'ShoppingCart class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
ShoppingCart class
	instanceVariableNames: ''!
!ShoppingCart class methodsFor: 'errors' stamp: 'nz 6/9/2021 23:47:56'!
             itemQuantityMustBeGreaterThanZeroErrorDescription
	^'Cannot add item with negative quantity!!'.! !
!ShoppingCart class methodsFor: 'errors' stamp: 'AW 6/10/2021 20:05:50'!
                    itemQuantyMustBeAnIntegerErrorDescription
	^'Quanty must be an integer!!'! !

Object subclass: #ShoppingCartEntry
	instanceVariableNames: 'item quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShoppingCartEntry category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #ShoppingCartEntry
	instanceVariableNames: 'item quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!ShoppingCartEntry methodsFor: 'initialization' stamp: 'AW 6/9/2021 00:31:25'!
initializeFor: anItem quantity: aQuantity 
	
	item := anItem.
	quantity := aQuantity.! !
!ShoppingCartEntry methodsFor: 'accessing' stamp: 'AW 6/9/2021 00:32:01'!
                             item
	
	^item! !
!ShoppingCartEntry methodsFor: 'accessing' stamp: 'AW 6/9/2021 00:32:11'!
     quantity
	
	^quantity! !
!ShoppingCartEntry methodsFor: 'testing' stamp: 'AW 6/9/2021 00:54:31'!
                               is: aQuantity of: anItem 
	^(item = anItem) and: [ quantity = aQuantity ].! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

ShoppingCartEntry class
	instanceVariableNames: ''!

!classDefinition: 'ShoppingCartEntry class' category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
ShoppingCartEntry class
	instanceVariableNames: ''!
!ShoppingCartEntry class methodsFor: 'instance creation' stamp: 'AW 6/9/2021 00:31:03'!
                  for: anItem quantity: aQuantity 

	^self new initializeFor: anItem quantity: aQuantity ! !

Object subclass: #TestStubs
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #TestStubs category: 'Tus-Libros' stamp: 'nz 6/24/2021 21:37:17'!
Object subclass: #TestStubs
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!TestStubs methodsFor: 'books' stamp: 'nz 6/23/2021 01:01:49'!
                    book1
	^'ISBN1'.! !
!TestStubs methodsFor: 'books' stamp: 'nz 6/23/2021 01:01:53'!
             book2
	^'ISBN2'.! !
!TestStubs methodsFor: 'books' stamp: 'nz 6/23/2021 01:12:43'!
             book3
	^'ISBN3'.! !
!TestStubs methodsFor: 'books' stamp: 'nz 6/23/2021 01:43:29'!
             priceList

	| bookPrices |
	bookPrices _ PriceList new.
	bookPrices set: self book1 price: 50.
	bookPrices set: self book2 price: 20.
	bookPrices set: self book3 price: 30.
	^bookPrices.! !
!TestStubs methodsFor: 'cards' stamp: 'nz 6/23/2021 00:43:00'!
   cardOwner
	^ 'PEPE SANCHEZ'.! !
!TestStubs methodsFor: 'cards' stamp: 'nz 6/23/2021 00:42:35'!
 invalidNumberCreditCard

	^ CreditCard
		number: '418241'
		owner: self cardOwner
		expiration: self currentMonth next.! !
!TestStubs methodsFor: 'cards' stamp: 'AW 6/24/2021 00:25:18'!
      mockAlwaysOkMerchantProcessor

	^MockAlwaysOkMerchantProcessor new.! !
!TestStubs methodsFor: 'cards' stamp: 'nz 6/23/2021 01:16:35'!
                          validCreditCard
	^CreditCard
		number: self validCreditCardNumber
		owner: self cardOwner
		expiration: self currentMonth next.! !
!TestStubs methodsFor: 'cards' stamp: 'nz 6/23/2021 01:16:56'!
                              validCreditCardNumber
	^'4182418241824182'.! !
!TestStubs methodsFor: 'time' stamp: 'nz 6/23/2021 00:43:27'!
                   currentMonth
	^ self today monthOfYear.! !
!TestStubs methodsFor: 'time' stamp: 'AW 6/24/2021 00:23:09'!
                       timeProvider
	^MockTimeProvider new.! !
!TestStubs methodsFor: 'time' stamp: 'nz 6/23/2021 00:43:41'!
                          today

	^ FixedGregorianDate today.! !

----End fileIn of /home/nikita/r/f/ingsoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/Tus-Libros.st----!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'nz 6/24/2021 21:37:27'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'nz 6/24/2021 21:38:02'!
PASSED!
!CheckOutTest methodsFor: 'setUp/tearDown' stamp: 'nz 6/24/2021 21:38:37' prior: 50331895 overrides: 16927572!
          setUp

	today _ FixedGregorianDate today.
	currentMonth _ today monthOfYear.
	
	creditCardNumber _ '4182418241824182'.
	cardOwner _ 'PEPE SANCHEZ'.

	stubs := TestStubs new.

	validCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth next.
	
	expiredCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth previous.
		
	expiredThisMonthCreditCard _ CreditCard
		number: creditCardNumber
		owner: cardOwner
		expiration: currentMonth.
		
	invalidNumberCreditCard _ stubs invalidNumberCreditCard.
		
	emptyOwnerCreditCard _ CreditCard
		number: creditCardNumber
		owner: ''
		expiration: currentMonth next.
		
	emptyOwnerCreditCard2 _ CreditCard
		number: creditCardNumber
		owner: '            '
		expiration: currentMonth next.
		
	book1 := stubs book1.
	book2 := stubs book2.
	
	mockAlwaysStolenCardMerchantProcessor _ MockAlwaysStolenCardMerchantProcessor new.
	mockAlwaysOkMerchantProcessor _ stubs mockAlwaysOkMerchantProcessor.
	mockAlwaysFakeCardMerchantProcessor _ MockAlwaysFakeCardMerchantProcessor new.
	mockAlwaysWithoutCreditCardMerchantProcessor _ MockAlwaysWithoutCreditCardMerchantProcessor new.! !

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'nz 6/24/2021 21:38:50'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'nz 6/24/2021 21:38:51'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'nz 6/24/2021 21:38:52'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'nz 6/24/2021 21:38:53'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'nz 6/24/2021 21:38:53'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'nz 6/24/2021 21:38:53'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'nz 6/24/2021 21:38:53'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'nz 6/24/2021 21:38:54'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'nz 6/24/2021 21:38:54'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'nz 6/24/2021 21:38:54'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'nz 6/24/2021 21:38:54'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'nz 6/24/2021 21:38:54'!
PASSED!

Object subclass: #StringGenius
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!

!classDefinition: #StringGenius category: 'StringsServicesServer' stamp: 'nz 6/24/2021 21:47:34'!
Object subclass: #StringGenius
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!
!StringGenius methodsFor: 'converting' stamp: 'NR 11/11/2019 16:14:06'!
          firstLetter: aWord
	
	^aWord at:1! !
!StringGenius methodsFor: 'converting' stamp: 'NR 6/24/2021 19:12:44'!
                    removeSpecialCharacters: aSentence
	
	^aSentence select:[:ch| ch isAlphaNumeric or: [ch isSeparator ]].! !
!StringGenius methodsFor: 'converting' stamp: 'NR 11/11/2019 16:14:58'!
             toLowercase: aWord
	
	^aWord translateToLowercase! !
!StringGenius methodsFor: 'converting' stamp: 'NR 11/11/2019 16:14:47'!
   toUppercase: aWord
	
	^aWord translateToUppercase! !
!StringGenius methodsFor: 'converting' stamp: 'NR 11/11/2019 16:44:40'!
   vowels: aWord
	
	^aWord select: [:letter | letter isVowel]! !
!StringGenius methodsFor: 'converting' stamp: 'NR 6/24/2021 19:16:17'!
                           words: aSentence
	
	^(self removeSpecialCharacters:aSentence) substrings! !

Object subclass: #StringsServicesRestInterface
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!

!classDefinition: #StringsServicesRestInterface category: 'StringsServicesServer' stamp: 'nz 6/24/2021 21:47:34'!
Object subclass: #StringsServicesRestInterface
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!
!StringsServicesRestInterface methodsFor: 'enabling services' stamp: 'NR 6/24/2019 06:51:52'!
                    destroy
	
	webServer ifNotNil:[webServer destroy].! !
!StringsServicesRestInterface methodsFor: 'enabling services' stamp: 'NR 6/23/2021 20:38:01'!
            startListening
	
	webServer startListener.

	^'Listening on port: ', self port asString.
	! !
!StringsServicesRestInterface methodsFor: 'enabling services' stamp: 'NR 11/11/2019 15:54:20'!
   stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', self port asString! !
!StringsServicesRestInterface methodsFor: 'initialization' stamp: 'NR 6/24/2021 19:18:02'!
 initializeWith: aPortNumber
	
	stringGenius := StringGenius new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := stringGenius words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := stringGenius firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := stringGenius vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := stringGenius toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !
!StringsServicesRestInterface methodsFor: 'initialization' stamp: 'NR 11/11/2019 17:19:18'!
                           port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].
	
	! !
!StringsServicesRestInterface methodsFor: 'private' stamp: 'NR 6/23/2021 20:29:59'!
                   quoteList
	
	^OrderedCollection with: 'You should have gone for the head' with: 'I Love you 3000!!' with: 'I am Groot!!' with: 'For All Time, Allways' with: 'I am inevitable...' with: 'Because Im Baaaatman!!'
	
	! !
!StringsServicesRestInterface methodsFor: 'private' stamp: 'NR 6/23/2021 20:33:19'!
                    sayRandomQuote
	| quotes |
	
	quotes := self quoteList.
	
	^quotes at: (quotes size atRandom).
	! !

"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!

StringsServicesRestInterface class
	instanceVariableNames: ''!

!classDefinition: 'StringsServicesRestInterface class' category: 'StringsServicesServer' stamp: 'nz 6/24/2021 21:47:34'!
StringsServicesRestInterface class
	instanceVariableNames: ''!
!StringsServicesRestInterface class methodsFor: 'as yet unclassified' stamp: 'NR 11/11/2019 15:43:02'!
 listeningOn: aPortNumber

	^self new initializeWith: aPortNumber.! !

----End fileIn of /home/nikita/r/f/ingsoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/StringsServicesServer.st----!

ssri := StringsServicesRestInterface listeningOn: 8080.!

Smalltalk allObjectsDo: [
	:obj |
	(obj isKindOf: StringsServicesRestInterface)
	ifTrue: [ obj stopListening. ]
].!


servers : OrderedCollection new.!


servers := OrderedCollection new.!

Smalltalk allObjectsDo: [
	:obj |
	(obj isKindOf: StringsServicesRestInterface)
	ifTrue: [ servers add: obj. ]
].!

servers!


servers do: [ :srv | srv stopListening ].!


servers do: [ :srv | srv destroy ].!

servers := OrderedCollection new.
!


Smalltalk allObjectsDo: [
  :obj |
  (obj isKindOf: StringsServicesRestInterface)
  ifTrue: [ servers add: obj. ]
].!

servers!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'nz 6/24/2021 22:13:15'!
PASSED!

----QUIT----(24 June 2021 22:13:29) CuisUniversity-4532.image priorSource: 18058935!

----STARTUP---- (27 June 2021 22:23:03) as /home/awolfsdorf/Dropbox/CSCOM/IngeSoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/CuisUniversity-4532.image!


Object subclass: #TusLibrosRestInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #TusLibrosRestInterface category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:31:33'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #TusLibrosRestInterface category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:31:51'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!TusLibrosRestInterface class methodsFor: 'no messages' stamp: 'AW 6/27/2021 22:32:38'!
                on: aPort! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:33:46' prior: 50333994!
   on: aPort

	^self new withPort: aPort! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:34:16' prior: 50333998!
       on: aPort

	^self new initializeOn: aPort! !
!TusLibrosRestInterface methodsFor: 'nil' stamp: 'AW 6/27/2021 22:36:08'!
         initializeOn: aPort

	port := aPort.
	
	webServer := WebServer new listenOn: self port.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:37:13'!
           port

	^port ifNil: [ port _ 8080].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:37:37' prior: 50334007!
               initializeOn: aPort

	port := aPort.
	
	webServer := WebServer new listenOn: self port.
	
	self configRoutes.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:43:07'!
                     configRoutes

	self addService: '/sayHello' action: [ :request | request send200Response: 'Que ondas' ].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:44:24'!
                          addService: aRouteString action: aBlockClosure

	webServer addService: aRouteString action: aBlockClosure.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:44:56'!
                        destroy
	webServer ifNotNil: [ webServer destroy ].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:45:09'!
               startListening
	webServer startListener.
	^ 'Listening on port: ' , self port asString.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:45:14'!
           stopListening
	webServer stopListener.
	^ 'Stopped listening from port: ' , self port asString.! !

tusLibrosWebServer _ TusLibrosRestInterface on: 8080.!

tusLibrosWebServer startListening.!

tusLibrosWebServer stopListening !

tusLibrosWebServer destroy !

tusLibrosWebServer destroy.!

stubs _ TestStubs new. !

!classDefinition: #ShopConfiguration category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:55:12'!
Object subclass: #ShopConfiguration
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!


shopConfiguration _ ShopConfiguration 
		withUserAuthenticator: (stubs mockUserAuthenticatorAlwaysReturning: false)
		prices: stubs priceList
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor
		timeProvider: stubs timeProvider.!
!TestStubs methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:55:35'!
        mockUserAuthenticatorAlwaysReturning: aFalse 
	self shouldBeImplemented.! !
!TestStubs methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:55:51' prior: 50334077!
                       mockUserAuthenticatorAlwaysReturning: aFalse 
	MockUserAuthenticator alwaysReturning: false.! !
!TestStubs methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:56:07' prior: 50334083!
   mockUserAuthenticatorAlwaysReturning: aBoolean
	^MockUserAuthenticator alwaysReturning: aBoolean.! !
!ShopConfiguration class methodsFor: 'instance creation' stamp: 'AW 6/27/2021 22:56:18'!
  withUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aMockTimeProvider 
	"DO NOT FORGET TO RENAME COLLABORATORS AND REMOVE THIS COMMENT!!!!"
	self shouldBeImplemented.
	^self new initializeWithUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aMockTimeProvider ! !
!ShopConfiguration class methodsFor: 'instance creation' stamp: 'AW 6/27/2021 22:56:44' prior: 50334095!
                       withUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aMockTimeProvider 


	^self new initializeWithUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aMockTimeProvider ! !
!ShopConfiguration class methodsFor: 'instance creation' stamp: 'AW 6/27/2021 22:56:52' prior: 50334112!
                     withUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aTimeProvider 


	^self new initializeWithUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMockAlwaysOkMerchantProcessor timeProvider: aTimeProvider ! !
!ShopConfiguration class methodsFor: 'instance creation' stamp: 'AW 6/27/2021 22:57:04' prior: 50334126!
                             withUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider 


	^self new initializeWithUserAuthenticator: aMockUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider ! !
!ShopConfiguration class methodsFor: 'instance creation' stamp: 'AW 6/27/2021 22:57:11' prior: 50334140!
                     withUserAuthenticator: aUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider 


	^self new initializeWithUserAuthenticator: aUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider ! !

!classDefinition: #ShopConfiguration category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:57:26'!
Object subclass: #ShopConfiguration
	instanceVariableNames: 'userAuthenticator'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShopConfiguration category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:57:26'!
Object subclass: #ShopConfiguration
	instanceVariableNames: 'userAuthenticator priceList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShopConfiguration category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:57:26'!
Object subclass: #ShopConfiguration
	instanceVariableNames: 'userAuthenticator priceList merchantProcessor'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!classDefinition: #ShopConfiguration category: 'Tus-Libros' stamp: 'AW 6/27/2021 22:57:26'!
Object subclass: #ShopConfiguration
	instanceVariableNames: 'userAuthenticator priceList merchantProcessor timeProvider'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!ShopConfiguration methodsFor: 'initialization' stamp: 'AW 6/27/2021 22:57:26'!
                       initializeWithUserAuthenticator: aUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider 
	self shouldBeImplemented.
	userAuthenticator := aUserAuthenticator.
	priceList := aPriceList.
	merchantProcessor := aMerchantProcessor.
	timeProvider := aTimeProvider.! !
!ShopConfiguration methodsFor: 'initialization' stamp: 'AW 6/27/2021 22:57:37' prior: 50334198!
          initializeWithUserAuthenticator: aUserAuthenticator prices: aPriceList merchantProcessor: aMerchantProcessor timeProvider: aTimeProvider 
	userAuthenticator := aUserAuthenticator.
	priceList := aPriceList.
	merchantProcessor := aMerchantProcessor.
	timeProvider := aTimeProvider.! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:58:42'!
     on: aPort shopConfiguration: aShopConfiguration 

	^self new initializeOn: aPort! !

!methodRemoval: TusLibrosRestInterface class #on: stamp: 'AW 6/27/2021 22:58:42'!
on: aPort

	^self new initializeOn: aPort!
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:59:04' prior: 50334223!
                              on: aPort shopConfiguration: aShopConfiguration 

	^self new initializeOn: aPort! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:59:35'!
                  initializeOn: aPort shopConfiguration: aShopConfiguration 

	port := aPort.
	
	webServer := WebServer new listenOn: self port.
	
	self configRoutes.! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 22:59:35' prior: 50334234!
                        on: aPort shopConfiguration: aShopConfiguration 

	^self new initializeOn: aPort shopConfiguration: aShopConfiguration! !

!methodRemoval: TusLibrosRestInterface #initializeOn: stamp: 'AW 6/27/2021 22:59:35'!
initializeOn: aPort

	port := aPort.
	
	webServer := WebServer new listenOn: self port.
	
	self configRoutes.!

!classDefinition: #TusLibrosRestInterface category: 'Tus-Libros' stamp: 'AW 6/27/2021 23:01:52'!
Object subclass: #TusLibrosRestInterface
	instanceVariableNames: 'webServer port shop'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:01:50' prior: 50334240!
                      initializeOn: aPort shopConfiguration: aShopConfiguration 

	shop := self createShopFrom: aShopConfiguration.
	port := aPort.
	webServer := WebServer new listenOn: self port.
	
	self configRoutes.! !

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:02:22'!
 createShopFrom: aShopConfiguration 
	self shouldBeImplemented.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:04:20' prior: 50334283!
                    createShopFrom: aShopConfiguration 
	^aShopConfiguration create.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:04:29' prior: 50334289!
                  createShopFrom: aShopConfiguration 
	^aShopConfiguration createShop.! !
!ShopConfiguration methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:04:40'!
   createShop
	self shouldBeImplemented.! !
!ShopConfiguration methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:05:19' prior: 50334300!
                  createShop
	^Shop 
		withUserAuthenticator: userAuthenticator 
		prices: priceList 
		merchantProcessor: merchantProcessor 
		timeProvider: timeProvider.! !

tusLibrosWebServer startListening .!

tusLibrosWebServer destroy.!

WebUtils jsonEncode: 'Hola'!

WebUtils jsonEncode: 3 !

WebUtils jsonEncode: Dictionary new!

dict _ Dictionary new.!

dict at: 'id' put: 'tumama'!

WebUtils jsonEncode: dict.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:20:18' prior: 50334025!
   configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		response _ Dictionary new.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		response at: 'cartId' put: cartId.
		request send200Response: WebUtils jsonEncode: response.
		
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:20:46' prior: 50334321!
                      configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		response _ Dictionary new.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:22:05' prior: 50334335!
                    configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		response _ Dictionary new.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:22:20' prior: 50334349!
                      configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:25:17' prior: 50334366!
                   configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | 
		cartItems _ shop listCart: cartId.
		
		response _ Dictionary new.
		response at: 'items' put: cartItems.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:25:48' prior: 50334383!
                 configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | 
		cartId _ request fields at: 'cartId'.
		cartItems _ shop listCart: cartId.
		
		response _ Dictionary new.
		response at: 'items' put: cartItems.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. !

tusLibrosWebServer startListening .!

onfiguration 
		withUserAuthenticator: (stubs mockUserAuthenticatorAlwaysReturning: true)
		prices: stubs priceList
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor
		timeProvider: stubs timeProvider. !


shopConfiguration _ ShopConfiguration 
		withUserAuthenticator: (stubs mockUserAuthenticatorAlwaysReturning: true)
		prices: stubs priceList
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor
		timeProvider: stubs timeProvider. !

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. !

tusLibrosWebServer startListening.!

tusLibrosWebServer destroy !


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
!

tusLibrosWebServer startListening.
!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

TusLibrosRestInterface allInstances destroy .!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].!

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. !

tusLibrosWebServer startListening.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:37:15' prior: 50334408!
        configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | 
		cartId _ request fields at: 'cartId' asNumber .
		cartItems _ shop listCart: cartId.
		
		response _ Dictionary new.
		response at: 'items' put: cartItems.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !


tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 

tusLibrosWebServer startListening.
!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/27/2021 23:37:37' prior: 50334483!
                           configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | 
		cartId _ (request fields at: 'cartId') asNumber .
		cartItems _ shop listCart: cartId.
		
		response _ Dictionary new.
		response at: 'items' put: cartItems.
		request send200Response: (WebUtils jsonEncode: response).
		
	].! !


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 

tusLibrosWebServer startListening.!

tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 

tusLibrosWebServer startListening.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!


tusLibrosWebServer stopListening.
tusLibrosWebServer destroy.!


TusLibrosRestInterface allInstances do: [ :x | x destroy ].!

servers _ OrderedCollection new.!
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/27/2021 23:56:19' prior: 50332084!
                          test03ListCartWithOneItem
	
	| shop cartId cartItems bookIsbn quantity |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems size equals: 1.
	self assert: (cartItems first at: 'quantity') equals: quantity.
	self assert: (cartItems first at: 'item') equals: bookIsbn.! !
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/27/2021 23:56:50' prior: 50334562!
                           test03ListCartWithOneItem
	
	| shop cartId cartItems bookIsbn quantity |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems size equals: 1.
	self assert: (cartItems first at: 'quantity') equals: quantity.
	self assert: (cartItems first at: 'item') equals: bookIsbn.! !

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/27/2021 23:57:11'!
ERROR!
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:02:16' prior: 50333132!
                 getCartEntries: aShoppingCartId

	^ (self getCart: aShoppingCartId) entries collect: [ :cartEntry | | ccc | 
		ccc _ Dictionary new.
		ccc at: 'item'	 put: cartEntry item.
		ccc at: 'quantity'	 put: cartEntry quantity.
	].! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:03:09' prior: 50334612!
         getCartEntries: aShoppingCartId

	^ self getEntriesAsDictionary: (self getCart: aShoppingCartId) entries.! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:04:45'!
              getEntriesAsDictionary: aEntryList

	^ aEntryList collect: [ :cartEntry | | entryDictionary | 
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: cartEntry item.
		entryDictionary at: 'quantity'	 put: cartEntry quantity.
	].! !

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:04:58'!
ERROR!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 00:04:58'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:04:58'!
ERROR!

self!

self at: 0!

self at: 1!
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:07:30' prior: 50334628!
 getEntriesAsDictionary: aEntryList

	^ aEntryList collect: [ :cartEntry | | entryDictionary | 
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: cartEntry item.
		entryDictionary at: 'quantity'	 put: cartEntry quantity.
		entryDictionary.
	].! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:07:37' prior: 50334693!
getEntriesAsDictionary: aEntryList

	^ aEntryList collect: [ :cartEntry | | entryDictionary | 
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: cartEntry item.
		entryDictionary at: 'quantity'	 put: cartEntry quantity.
		entryDictionary
	].! !

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:08:04'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 00:08:09'!
PASSED!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 00:09:47'!
PASSED!


tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 

tusLibrosWebServer startListening.!

WebUtils jsonEncode: OrderedCollection new!

OrderedCollection new asArray !

WebUtils jsonEncode: OrderedCollection new asArray !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:13:42' prior: 50334704!
                         getEntriesAsDictionary: aEntryList

	^ aEntryList collect: [ :cartEntry | | entryDictionary | 
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: cartEntry item.
		entryDictionary at: 'quantity'	 put: cartEntry quantity.
		entryDictionary
	] asArray.! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 00:13:56' prior: 50334897!
                         getEntriesAsDictionary: aEntryList

	^ (aEntryList collect: [ :cartEntry | | entryDictionary | 
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: cartEntry item.
		entryDictionary at: 'quantity'	 put: cartEntry quantity.
		entryDictionary
	]) asArray.! !

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 00:14:11'!
PASSED!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.
!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.
!

----QUIT----(28 June 2021 00:16:53) CuisUniversity-4532.image priorSource: 73944!

----STARTUP---- (28 June 2021 19:04:22) as /home/awolfsdorf/Dropbox/CSCOM/IngeSoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/CuisUniversity-4532.image!

!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:10:29' prior: 50334514!
          configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | 
		clientId _ request fields at: 'clientId'.
		clientPassword _ request fields at: 'password'.
		cartId _ shop createCartClientId: clientId password: clientPassword.
		
		response _ Dictionary new.
		response at: 'cartId' put: cartId.
		request send200Response: (WebUtils jsonEncode: response).
		
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | 
		cartId _ (request fields at: 'cartId') asNumber .
		bookIsbn _ request fields at: 'boookIsbn'.
		bookQuantity _ (request fields at: 'bookQuantity') asNumber.
		
		shop add: bookQuantity of: bookIsbn to: cartId.
		
		response _ Dictionary new.
		response at: 'response' put: 'OK'.
		request send200Response: (WebUtils jsonEncode: response).
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | 
		cartId _ (request fields at: 'cartId') asNumber .
		cartItems _ shop listCart: cartId.
		
		response _ Dictionary new.
		response at: 'items' put: cartItems.
		request send200Response: (WebUtils jsonEncode: response).
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:14:08' prior: 50335060!
      configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'boookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:17:56' prior: 50335100!
                 configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			self inspect.
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'boookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:18:57' prior: 50335155!
configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			self halt.
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'boookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

self fields!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:20:36' prior: 50335210!
                     configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			self halt.
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:23:15' prior: 50335266!
    configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:42:48' prior: 50335321!
                  configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			self halt.
			cced _ FixedGregorianDate fromDate: (request fields at: 'cced')  .
			cco _ request fields at: 'cco'.
			
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].
! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

(request fields at: 'cced')!

FixedGregorianDate fromDate: (request fields at: 'cced')!

FixedGregorianDate fromDate: '10/15/2025' !

FixedGregorianDate fromDate: '2025/12/12' !

FixedGregorianDate monthOfYear: '12/2022' dayNumber: 10!

(GregorianMonthOfYear year: 2022 month: 12)!

(GregorianMonthOfYear year: 2022 month: 12)!

(GregorianMonthOfYear year: 2022 month: 12)!

(GregorianMonthOfYear year: 2022 month: 12)!

(GregorianMonthOfYear year: 2022 monthNumber: 12)!

(GregorianMonthOfYear yearNumber: 2022 monthNumber: 12)!

'10/2024' findTokens: '/'!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 19:59:59' prior: 50335376!
                configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			self halt.
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) 
				monthNumber: (ccedSplitted at: 1). 
			
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].
! !

----QUIT----(28 June 2021 20:03:53) CuisUniversity-4532.image priorSource: 108829!

----STARTUP---- (28 June 2021 20:04:17) as /home/awolfsdorf/Dropbox/CSCOM/IngeSoft1/Inge1-ejercicios/20-TusLibros-Iteracion-4/CuisUniversity-4532.image!

!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:06:24' prior: 50335469!
                         configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) 
				monthNumber: (ccedSplitted at: 1). 
			
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:07:31' prior: 50335550!
                       configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) 
				monthNumber: (ccedSplitted at: 1). 
			self halt.
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:08:25' prior: 50335629!
             configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			self halt.
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) 
				monthNumber: (ccedSplitted at: 1). 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:10:11' prior: 50335708!
                configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			self halt.
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:14:48' prior: 50335793!
  configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:24:02' prior: 50335884!
          configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			self halt.
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

anError messageText!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:27:56' prior: 50335963!
         configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!


TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 20:29:51' prior: 50336049!
       configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | clientId password purchases response | [
			clientId _ (request fields at: 'clientId') asNumber.
			password _ request fields at: 'password'.
			
			purchases _ shop listPurchasesOf: clientId with: password.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 20:40:07' prior: 50333096!
                             listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	
	dictionary _ Dictionary new.
	
	
	! !
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 20:40:48' prior: 50336246!
                        listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: purchases total.! !
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 20:41:25' prior: 50336257!
                listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: purchases total.
	dictionary at: 'items' put: purchases items asArray.! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 21:15:45' prior: 50334909!
                getEntriesAsDictionary: aEntryBag

	^(aEntryBag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (aEntryBag ocurrencesOf: item).
		entryDictionary
	]) asArray.! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 21:16:01' prior: 50336283!
                        getEntriesAsDictionary: aEntryBag

	^(aEntryBag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (aEntryBag occurrencesOf: item).
		entryDictionary
	]) asArray.! !
!ShoppingCart methodsFor: 'adding' stamp: 'AW 6/28/2021 21:17:44' prior: 50333257!
                         add: aQuantity of: anItem 

	self assertQuantityIsValid: aQuantity.
	
	entries add: anItem withQuantity: aQuantity.! !
!ShoppingCart methodsFor: 'initialization' stamp: 'AW 6/28/2021 21:18:02' prior: 50333275 overrides: 16896425!
                          initialize

	entries := Bag new.! !
!ShoppingCart methodsFor: 'adding' stamp: 'AW 6/28/2021 21:18:29' prior: 50336307!
         add: aQuantity of: anItem 

	self assertQuantityIsValid: aQuantity.
	
	entries add: anItem withOccurrences: aQuantity.! !

!classRemoval: #ShoppingCartEntry stamp: 'AW 6/28/2021 21:18:55'!
Object subclass: #ShoppingCartEntry
	instanceVariableNames: 'item quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 21:19:14'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:19:14'!
ERROR!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:19:14'!
FAILURE!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 21:19:14'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 21:19:14'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 21:19:14'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:19:19'!
ERROR!
!ShoppingCartTest methodsFor: 'assertions' stamp: 'AW 6/28/2021 21:26:52' prior: 50332479!
      assert: shoppingCart has: quantity of: item

	self assert: (shoppingCart entries occurrencesOf: item) equals: quantity ! !

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:27:02'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:27:04'!
FAILURE!
!ShoppingCartTest methodsFor: 'adding items' stamp: 'AW 6/28/2021 21:28:10' prior: 50332505!
test03AddingMultipleItemsToACart
	| shoppingCart |

	shoppingCart := ShoppingCart new.
	
	shoppingCart add: 1 of: book1.
	shoppingCart add: 2 of: book2.
	
	self assert: shoppingCart entries size equals: 3.
	self assert: shoppingCart has: 1 of: book1.
	self assert: shoppingCart has: 2 of: book2.! !

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:28:12'!
PASSED!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 21:28:24'!
ERROR!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 21:28:24'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:28:28'!
ERROR!
!Cashier methodsFor: 'validation' stamp: 'AW 6/28/2021 21:29:10' prior: 50332588!
                              areAllItemsInPriceList: aBagOfShoppingCartEntries

	^ aBagOfShoppingCartEntries allSatisfy: [ :entry | priceList hasPriceFor: entry item ]! !
!Cashier methodsFor: 'validation' stamp: 'AW 6/28/2021 21:29:22' prior: 50336506!
areAllItemsInPriceList: aBagOfItems

	^ aBagOfItems allSatisfy: [ :entry | priceList hasPriceFor: entry item ]! !
!Cashier methodsFor: 'validation' stamp: 'AW 6/28/2021 21:29:46' prior: 50336513!
                            areAllItemsInPriceList: aBagOfItems

	^ aBagOfItems asSet allSatisfy: [ :item | priceList hasPriceFor: item ]! !

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:29:47'!
ERROR!
!Cashier methodsFor: 'private' stamp: 'AW 6/28/2021 21:31:29' prior: 50332569!
priceFor: anItem
	
	^(priceList priceFor: anItem item) * (anItem quantity).! !
!Cashier methodsFor: 'private' stamp: 'AW 6/28/2021 21:31:48' prior: 50336529!
  priceFor: anItem
	
	^priceList priceFor: anItem.! !
!Cashier methodsFor: 'private' stamp: 'AW 6/28/2021 21:32:34' prior: 50332544!
                             calculateShoppingCartTotal: aShoppingCart

	^ aShoppingCart entries sum: [ :item |
		self priceFor: item.
	] ifEmpty: [
		self error: self class cantCheckoutEmptyCartErrorDescription .
	]! !

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:32:38'!
ERROR!
!Cashier methodsFor: 'private' stamp: 'AW 6/28/2021 21:33:27' prior: 50332552!
                  createReceiptWithTotal: anAmountOfMoney cart: aShoppingCart 

	| receipt |
	
	receipt _ Receipt withTotal: anAmountOfMoney items: aShoppingCart entries.
	receiptBook add: receipt.
	
	^receipt .! !

aShoppingCart entries!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:33:35'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 21:33:36'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 21:33:37'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 21:33:37'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 21:33:37'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 21:33:38'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 21:33:38'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 21:33:38'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 21:33:38'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:33:39'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:33:39'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:33:40'!
ERROR!
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 21:34:59' prior: 50336269!
                            listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: purchases total.
	dictionary at: 'items' put: purchases items asArray.
	^dictionary ! !

purchases items!

self asSet!
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 21:38:51'!
                   getBagAsDictionaryArray: aEntryBag

	^(aEntryBag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (aEntryBag occurrencesOf: item).
		entryDictionary
	]) asArray.! !
!Shop methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:38:51' prior: 50334622!
                   getCartEntries: aShoppingCartId

	^ self getBagAsDictionaryArray: (self getCart: aShoppingCartId) entries.! !

!methodRemoval: Shop #getEntriesAsDictionary: stamp: 'AW 6/28/2021 21:38:51'!
getEntriesAsDictionary: aEntryBag

	^(aEntryBag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (aEntryBag occurrencesOf: item).
		entryDictionary
	]) asArray.!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:39:04'!
ERROR!
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 21:39:45' prior: 50336603!
   listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: purchases total.
	dictionary at: 'items' put: (self getBagAsDictionaryArray: purchases items).
	^dictionary ! !

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:39:48'!
ERROR!
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'AW 6/28/2021 21:40:32' prior: 50332247!
                     test08ListPurchasesOnOnlyOneBuyClient
	
	| shop cartId clientId password purchases |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	cartId := shop createCartClientId: clientId password: password.
	
	shop add: 2 of: stubs book1 to: cartId.
	
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	purchases := shop listPurchasesOf: clientId with: password.
	self assert: (purchases at: 'total') equals: 100.
	self assert: (purchases at: 'items') size equals: 2.
	self assert: (purchases items occurrencesOf: stubs book1) equals: 2.
	! !

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:40:37'!
FAILURE!
!ShopTest methodsFor: 'check out and purchase listing' stamp: 'AW 6/28/2021 21:43:11' prior: 50336669!
                   test08ListPurchasesOnOnlyOneBuyClient
	
	| shop cartId clientId password purchases |
	
	shop := Shop withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) prices: stubs priceList merchantProcessor: stubs mockAlwaysOkMerchantProcessor timeProvider: stubs timeProvider.
		
	clientId := 15.
	password := '123456'.
	cartId := shop createCartClientId: clientId password: password.
	
	shop add: 2 of: stubs book1 to: cartId.
	
	shop checkOut: cartId payingWith: stubs validCreditCard.
	
	purchases := shop listPurchasesOf: clientId with: password.
	self assert: (purchases total) equals: 100.
	self assert: (purchases items) size equals: 2.
	self assert: (purchases items occurrencesOf: stubs book1) equals: 2.
	! !
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 21:44:01' prior: 50336650!
listPurchasesOf: aClientId with: aClientPassword
	| dictionary purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: purchases total.
	dictionary at: 'items' put: (self getBagAsDictionaryArray: purchases items).
	^purchases ! !

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:44:03'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 21:44:04'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 21:44:05'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 21:44:05'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 21:44:06'!
PASSED!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 21:44:13'!
PASSED!
!Shop methodsFor: 'facade' stamp: 'AW 6/28/2021 21:44:36' prior: 50336724!
  listPurchasesOf: aClientId with: aClientPassword
	| purchases |
	self
		authenticateClient: aClientId
		withPassword: aClientPassword.
	purchases _ PurchasesSummary for: (self receiptsFor: aClientId).
	
	^purchases ! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:46:35'!
           serializePurchases: aPurchasesSummary
	| dictionary |
	
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: aPurchasesSummary total.
	dictionary at: 'items' put: (self getBagAsDictionaryArray: aPurchasesSummary items).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:46:42' prior: 50336884!
               serializePurchases: aPurchasesSummary
	| dictionary |
	
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: aPurchasesSummary total.
	dictionary at: 'items' put: (self getBagAsDictionaryArray: aPurchasesSummary items).
	
	^dictionary .! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:47:40' prior: 50336158!
                              configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | clientId password purchases response | [
			clientId _ (request fields at: 'clientId') asNumber.
			password _ request fields at: 'password'.
			
			purchases _ shop listPurchasesOf: clientId with: password.
			
			response _ Dictionary new.
			response at: 'purchases' put: (self serializePurchases: purchases).
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 21:47:48'!
PASSED!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:48:12' prior: 50336907!
               configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | clientId password purchases response | [
			self halt.
			clientId _ (request fields at: 'clientId') asNumber.
			password _ request fields at: 'password'.
			
			purchases _ shop listPurchasesOf: clientId with: password.
			
			response _ Dictionary new.
			response at: 'purchases' put: (self serializePurchases: purchases).
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:50:18' prior: 50337116!
                  configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | | clientId password purchases response | [
			self halt.
			clientId _ (request fields at: 'clientId') asNumber.
			password _ request fields at: 'password'.
			
			purchases _ shop listPurchasesOf: clientId with: password.
			
			response _ Dictionary new.
			response at: 'purchases' put: (self serializePurchases: purchases).
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:55:38'!
                              handleListPurchasesRequest: request
	| clientId password purchases response |
	self halt.
	clientId _ (request fields at: 'clientId') asNumber.
	password _ request fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	request send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:55:50' prior: 50337302!
                         handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	self halt.
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:55:55' prior: 50337319!
                     handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	
	self halt.
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:56:25' prior: 50337212!
                   configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | [
			self handleListPurchasesRequest: request
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 21:57:50' prior: 50337353!
      configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | [
			self handleListPurchasesRequest: request
		] onErrorDo: [ :anError |
			request send400Response: (anError messageText) 
		]
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:00:19' prior: 50337432!
               configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request 
	] onErrorDo: [ :request :anError |
		request send400Response: (anError messageText) 
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:00:37'!
                          addService: aString action: aBlockClosure onErrorDo: aBlockClosure3 
	self shouldBeImplemented.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:01:06' prior: 50337608!
                   addService: aRootString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	self shouldBeImplemented.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:02:47' prior: 50337615!
           addService: aRouteString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	
	webServer addService: aRouteString action: [ :aRequest |
		(aBlockClosure value: aRequest) on: Error do: aErrorBlockClosure.
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:04:34' prior: 50337622!
 addService: aRouteString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	
	webServer addService: aRouteString action: [ :aRequest |
		(aBlockClosure value: aRequest) on: Error do: [ :anError |
			aErrorBlockClosure value: anError
		].
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:09:08' prior: 50337632!
                              addService: aRouteString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	
	webServer addService: aRouteString action: [ :aRequest |
		[ aBlockClosure value: aRequest ] on: Error do: [ :anError |
			aErrorBlockClosure value: anError
		].
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:12:42' prior: 50337644!
                            addService: aRouteString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	
	webServer addService: aRouteString action: ([ :aRequest |
		aBlockClosure value: aRequest 
	] on: Error do: [ :anError |
		aErrorBlockClosure value: anError
	]).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:13:44' prior: 50334032!
addService: aRouteString action: aBlockClosure

	self addService: aRouteString 
		action: aBlockClosure 
		onErrorDo: [ :anError |
		
	].
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:15:01' prior: 50337656!
        addService: aRouteString action: aBlockClosure onErrorDo: aErrorBlockClosure 
	
	webServer addService: aRouteString action: [ :aRequest |
		[ aBlockClosure value: aRequest ] on: Error do: [ :anError |
			aErrorBlockClosure value: aRequest value: anError.	
		] 
	].! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:16:29' prior: 50337667!
          addService: aRouteString action: aBlockClosure

	self addService: aRouteString 
		action: aBlockClosure 
		onErrorDo: [ :aRequest :anError |
		
	].
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:16:45' prior: 50337687!
                              addService: aRouteString action: aBlockClosure

	self addService: aRouteString 
		action: aBlockClosure 
		onErrorDo: [ :aRequest :anError |
		aRequest send400Response: (anError messageText)
	].
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:16:57' prior: 50337523!
               configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request 
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 22:20:07' prior: 50337706!
                             configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ request fields at: 'clientId'.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

clientReceipts at: aClientId!

		self at: '10'!

(self findElementOrNil: arg1)!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:30:07' prior: 50337783!
               configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ (request fields at: 'clientId') asNumber.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: cartItems.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!

(self serializePurchases: purchases)!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:38:59' prior: 50337336!
                 handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!FormSection methodsFor: 'initialization' stamp: 'AW 6/28/2021 23:42:52' prior: 50814657!
               initializeWithTitle: arg1 withExplanation: arg2 withColor: arg3
	| temp4 |
	title _ arg1.
	explanation _ arg2.
	self separation: 3.
	self color: arg3.
	titleMorph _ LabelMorph 
		contents: title
		font: Preferences windowTitleFont
		emphasis: 1.
	temp4 _ LayoutSpec
		fixedWidth: titleMorph morphWidth
		fixedHeight: titleMorph morphHeight.
	temp4 offAxisEdgeWeight: 0.03.
	self
		addMorph: titleMorph
		layoutSpec: temp4.
	explanation isEmpty ifFalse: [
		explanationMorph _ ImmutableTextModelMorph
			withText: arg2
			withColor: arg3
			withWidth: self fixedWidthForTexts.
		self addMorph: explanationMorph ].! !
!LabeledInput methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:43:05' prior: 50814774!
                        withLabel: arg1 withWidth: arg2 withModel: arg3 usingAs: arg4
	| temp5 temp6 |
	self separation: 5.
	self layoutSpec:
		(LayoutSpec
			proportionalWidth: 0.95
			fixedHeight: LabeledInput recommendedHeight).
	labelMorph _ LabelMorph contents: arg1.
	temp5 _ LayoutSpec
		fixedWidth: arg2
		fixedHeight: labelMorph morphHeight
		offAxisEdgeWeight: #center.
	self
		addMorph: labelMorph
		layoutSpec: temp5.
	inputMorph _ TabPassingTextModelMorph withModel: arg3.
	inputMorph textMorph focusMover: arg4.
	arg4 addFocusReceiver: inputMorph textMorph.
	inputMorph hideScrollBarsIndefinitely.
	temp6 _ LayoutSpec
		fixedWidth: LabeledInput inputWidth * 0.7
		fixedHeight: labelMorph morphHeight + 2.
	self
		addMorph: inputMorph
		layoutSpec: temp6.! !
!MessageKeywordsAndParametersTable methodsFor: 'GUI building' stamp: 'AW 6/28/2021 23:43:22' prior: 50815089!
      buildColumnTitlesRowFor: arg1
	| temp2 temp3 |
	temp3 _ LayoutMorph newRow.
	temp3 color: self backgroundColor.
	temp3 separation: self columnSeparation.
	temp2 _ OrderedCollection newFrom: arg1.
	temp2 addFirst: ''.
	self needsToReorderRows ifTrue: [ temp2 addLast: 'Change order' ].
	temp2 withIndexDo: [ :arg4 :arg5 | | temp6 temp7 |
		temp7 _ LayoutMorph newRow.
		temp7 color: self backgroundColor.
		temp7 axisEdgeWeight: #center.
		temp7 addMorph: (LabelMorph contents: arg4).
		temp6 _ LayoutSpec fixedWidth: (columnWidths at: arg5).
		temp3
			addMorph: temp7
			layoutSpec: temp6 ].
	^ temp3.! !
!MessageKeywordsAndParametersTable methodsFor: 'initialization' stamp: 'AW 6/28/2021 23:43:31' prior: 50814979!
                  withRows: arg1 withColor: arg2 withPreviewModel: arg3 withRefactoringModel: arg4
	| temp5 temp6 temp7 temp8 temp9 temp10 temp11 |
	backgroundColor _ arg2.
	rowModels _ OrderedCollection new.
	previewModel _ arg3.
	refactoringModel _ arg4.
	variablesToParametrize _ arg1.
	temp5 _ 4.
	self separation: temp5.
	temp7 _ arg1 size + 1.
	temp6 _ self rowHeight * temp7 + (temp5 * (temp7 + 1)) * 1.1.
	temp10 _ #('Keyword' 'Parameter name' ).
	columnWidths _ self
		columnWidthsRequiredForRowTitles: arg1
		forInputColumns: temp10 size.
	temp9 _ columnWidths sum + (self columnSeparation * (columnWidths size + 1)) * 1.1.
	self layoutSpec:
		(LayoutSpec
			fixedWidth: temp9
			fixedHeight: temp6).
	temp8 _ self buildColumnTitlesRowFor: temp10.
	self
		addMorph: temp8
		layoutSpec: self rowsLayoutSpec.
	arg1 withIndexDo: [ :arg13 :arg14 | | temp15 temp16 temp17 temp18 temp19 |
		temp15 _ LayoutMorph newRow.
		temp15
			color: self backgroundColor;
			separation: self columnSeparation.
		temp15
			addMorph: (LabelMorph contents: arg13)
			layoutSpec: (LayoutSpec fixedWidth: (columnWidths at: 1)).
		temp18 _ LayoutSpec
			fixedWidth: (columnWidths at: 2)
			fixedHeight: self rowHeight.
		temp17 _ self buildInputMorphWith: (arg4 keywordModelOf: arg13).
		temp15
			addMorph: temp17
			layoutSpec: temp18.
		temp19 _ self buildInputMorphWith: (arg4 parameterModelOf: arg13).
		temp15
			addMorph: temp19
			layoutSpec: temp18.
		self needsToReorderRows ifTrue: [
			temp16 _ ChangeRowOrderButtonModel
				for: arg1 size - (arg14 - 1)
				notifying: self.
			rowModels addFirst: temp16.
			temp11 _ self buildChangeOrderButtonsWith: temp16.
			temp15
				addMorph: temp11
				layoutSpec: (LayoutSpec fixedWidth: columnWidths last) ].
		self
			addMorph: temp15
			layoutSpec: self rowsLayoutSpec ].! !

!classDefinition: #BagSerializer category: 'Tus-Libros' stamp: 'AW 6/28/2021 23:48:18'!
Object subclass: #BagSerializer
	instanceVariableNames: 'bag'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Tus-Libros'!
!BagSerializer class methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:48:18'!
 getBagAsDictionaryArray: aBag
	^self new initializeGetBagAsDictionaryArray: aBag! !
!BagSerializer methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:48:18'!
                           initializeGetBagAsDictionaryArray: aBag
	bag := aBag.! !
!BagSerializer methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:48:18'!
                      getBagAsDictionaryArray

	^(bag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (bag occurrencesOf: item).
		entryDictionary
	]) asArray.! !
!Shop methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:48:18' prior: 50336618!
          getBagAsDictionaryArray: aEntryBag
	^(BagSerializer getBagAsDictionaryArray: aEntryBag) getBagAsDictionaryArray! !
!BagSerializer methodsFor: 'initialization' stamp: 'AW 6/28/2021 23:49:09'!
 initializeWith: aBag
	bag := aBag.! !
!BagSerializer class methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:49:09' prior: 50338113!
                   getBagAsDictionaryArray: aBag
	^self new initializeWith: aBag! !

!methodRemoval: BagSerializer #initializeGetBagAsDictionaryArray: stamp: 'AW 6/28/2021 23:49:09'!
initializeGetBagAsDictionaryArray: aBag
	bag := aBag.!
!BagSerializer class methodsFor: 'instance creation' stamp: 'AW 6/28/2021 23:50:54' prior: 50338146!
getBagAsDictionaryArray: aBag
	^(self new initializeWith: aBag) getBagAsDictionaryArray ! !
!BagSerializer class methodsFor: 'instance creation' stamp: 'AW 6/28/2021 23:51:17' prior: 50338156!
                               getBagAsDictionaryArray: aBag
	^self new initializeWith: aBag ! !
!BagSerializer class methodsFor: 'instance creation' stamp: 'AW 6/28/2021 23:51:19' prior: 50338163!
                         getBagAsDictionaryArray: aBag
	^self new initializeWith: aBag ! !
!BagSerializer class methodsFor: 'instance creation' stamp: 'AW 6/28/2021 23:51:57'!
         bag: aBag
	^self new initializeWith: aBag ! !
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 23:51:57'!
             bag: aEntryBag
	^(BagSerializer getBagAsDictionaryArray: aEntryBag) getBagAsDictionaryArray! !
!Shop methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:51:57' prior: 50336630!
         getCartEntries: aShoppingCartId

	^ self bag: (self getCart: aShoppingCartId) entries.! !
!Shop methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:51:57' prior: 50338135!
              getBagAsDictionaryArray: aEntryBag
	^(BagSerializer bag: aEntryBag) getBagAsDictionaryArray! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:51:57' prior: 50336895!
                       serializePurchases: aPurchasesSummary
	| dictionary |
	
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: aPurchasesSummary total.
	dictionary at: 'items' put: (self bag: aPurchasesSummary items).
	
	^dictionary .! !
!Shop methodsFor: 'as yet unclassified' stamp: 'AW 6/28/2021 23:51:57' prior: 50338178!
    bag: aEntryBag
	^(BagSerializer bag: aEntryBag) getBagAsDictionaryArray! !

!methodRemoval: BagSerializer class #getBagAsDictionaryArray: stamp: 'AW 6/28/2021 23:51:57'!
getBagAsDictionaryArray: aBag
	^self new initializeWith: aBag !

!methodRemoval: Shop #getBagAsDictionaryArray: stamp: 'AW 6/28/2021 23:51:57'!
getBagAsDictionaryArray: aEntryBag
	^(BagSerializer bag: aEntryBag) getBagAsDictionaryArray!
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 23:54:13' prior: 50338184!
                    getCartEntries: aShoppingCartId

	| entriesBag |
	entriesBag _ (self getCart: aShoppingCartId) entries.
	^ (BagSerializer bag: entriesBag) getBagAsDictionaryArray .! !

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 23:54:25'!
PASSED!

!methodRemoval: Shop #bag: stamp: 'AW 6/28/2021 23:54:40'!
bag: aEntryBag
	^(BagSerializer bag: aEntryBag) getBagAsDictionaryArray!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 23:54:43'!
PASSED!
!Shop methodsFor: 'cart persistence' stamp: 'AW 6/28/2021 23:56:15' prior: 50338223!
  getCartEntries: aShoppingCartId

	^(self getCart: aShoppingCartId) entries.! !

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:56:54'!
FAILURE!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 23:56:54'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:56:54'!
FAILURE!
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/28/2021 23:57:22' prior: 50334586!
       test03ListCartWithOneItem
	
	| shop cartId cartItems bookIsbn quantity |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems size equals: 2.
	self assert: (cartItems first at: 'quantity') equals: quantity.
	self assert: (cartItems first at: 'item') equals: bookIsbn.! !

(cartItems occurrencesOf: bookIsbn)!
!ShopTest methodsFor: 'cart creation and listing' stamp: 'AW 6/28/2021 23:59:17' prior: 50338602!
                     test03ListCartWithOneItem
	
	| shop cartId cartItems bookIsbn quantity |
	
	shop := Shop 
		withUserAuthenticator: (MockUserAuthenticator alwaysReturning: true) 
		prices: stubs priceList 
		merchantProcessor: stubs mockAlwaysOkMerchantProcessor 
		timeProvider: stubs timeProvider.
	
	cartId := shop createCartClientId: 3 password: '1234'.
	
	quantity := 2.
	bookIsbn := 'book_isbn'.
		
	shop add: quantity of: bookIsbn to: cartId.
	
	cartItems := shop listCart: cartId.
	
	self assert: cartItems size equals: 2.
	self assert: (cartItems occurrencesOf: bookIsbn) equals: quantity.! !

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:59:23'!
PASSED!

!testRun: #CheckOutTest #test01CheckoutEmptyCartShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test02CheckoutACartWithOneItem stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test03CheckoutACartWithMultipleItems stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test04CheckoutItemWithoutPricesShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test05CheckoutWithExpiredCardShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test06CheckoutWithCardExpiredThisMonthShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test07CheckoutWithStolenCardShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test08CheckoutWithFakeCardShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test09CheckoutWithInsufficientFundsShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test10CheckoutWithInvalidCardNumberShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test11CheckoutWithEmptyCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #CheckOutTest #test12CheckoutWithBlankCardOwnerNameShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #PriceListTest #test01AddItemWithNegativePriceShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #PriceListTest #test02AddItemWithZeroPriceShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test01InvalidClientShallNotPass stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test02NewCartsAreEmpty stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test03ListCartWithOneItem stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test04ListInvalidCartShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test05AddItemToCartDoesntModifyOtherCarts stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test06CheckoutInvalidCartIdShouldRaiseError stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test07CheckoutUsesTheCashier stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test08ListPurchasesOnOnlyOneBuyClient stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test09ListPurchasesOfManyItemsByOneClient stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test10CheckoutWithInvalidCreditCardShouldFail stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test11ListMultiplePurchasesOfTheSameClient stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test12ListPurchasesOfIncorrectPasswordShouldFail stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test13ListPurchasesOfDifferentClients stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test14CheckingOutAnExpiredCardShouldFail stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test15CheckingOutInADifferentPointInTimeShouldWorkAsIntended stamp: 'AW 6/28/2021 23:59:27'!
PASSED!

!testRun: #ShopTest #test16AddingItemsToAnExpiredCartShouldFail stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test01EmptyCartHasNoItems stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test02AddingAnItemToACart stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test03AddingMultipleItemsToACart stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test04AddingANegativeQuantityRaisesError stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test05AddingZeroQuantityRaisesError stamp: 'AW 6/28/2021 23:59:28'!
PASSED!

!testRun: #ShoppingCartTest #test06AddingNonIntegerQuantityRaisesError stamp: 'AW 6/28/2021 23:59:28'!
PASSED!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:04:08' prior: 50337868!
       configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ (request fields at: 'clientId') asNumber.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: (BagSerializer bag: cartItems) getBagAsDictionaryArray .
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !
!BagSerializer methodsFor: 'evaluating' stamp: 'AW 6/29/2021 00:04:23'!
      asDictionaryArray

	^(bag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (bag occurrencesOf: item).
		entryDictionary
	]) asArray.! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:04:23' prior: 50338771!
                              configRoutes
	
	
	self addService: '/createCart' action: [ :request | | cartId clientId clientPassword response | [
			clientId _ (request fields at: 'clientId') asNumber.
			clientPassword _ request fields at: 'password'.
			cartId _ shop createCartClientId: clientId password: clientPassword.
			
			response _ Dictionary new.
			response at: 'cartId' put: cartId.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !

!methodRemoval: BagSerializer #getBagAsDictionaryArray stamp: 'AW 6/29/2021 00:04:23'!
getBagAsDictionaryArray

	^(bag asSet collect: [ :item | | entryDictionary |
		entryDictionary _ Dictionary new.
		entryDictionary at: 'item'	 put: item.
		entryDictionary at: 'quantity'	 put: (bag occurrencesOf: item).
		entryDictionary
	]) asArray.!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:06:29' prior: 50337958!
                         handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	
	self halt.
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:07:26' prior: 50338197!
                   serializePurchases: aPurchasesSummary
	| dictionary |
	
	dictionary _ Dictionary new.
	
	dictionary at: 'total' put: aPurchasesSummary total.
	dictionary at: 'items' put: (BagSerializer bag: aPurchasesSummary items) asDictionaryArray.
	
	^dictionary .! !

aPurchasesSummary items!

(BagSerializer bag: aPurchasesSummary items) asDictionaryArray!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:08:39' prior: 50338955!
                            handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:10:46'!
               handleCreateCartRequest: request
	| cartId clientId clientPassword response |
	clientId _ (request fields at: 'clientId') asNumber.
	clientPassword _ request fields at: 'password'.
	cartId _ shop createCartClientId: clientId password: clientPassword.
	
	response _ Dictionary new.
	response at: 'cartId' put: cartId.
	request send200Response: (WebUtils jsonEncode: response).
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:10:53' prior: 50339003!
                          handleCreateCartRequest: request
	| cartId clientId clientPassword response |
	
	clientId _ (request fields at: 'clientId') asNumber.
	clientPassword _ request fields at: 'password'.
	cartId _ shop createCartClientId: clientId password: clientPassword.
	
	response _ Dictionary new.
	response at: 'cartId' put: cartId.
	request send200Response: (WebUtils jsonEncode: response).
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:10:56' prior: 50339019!
                        handleCreateCartRequest: Arequest
	| cartId clientId clientPassword response |
	
	clientId _ (Arequest fields at: 'clientId') asNumber.
	clientPassword _ Arequest fields at: 'password'.
	cartId _ shop createCartClientId: clientId password: clientPassword.
	
	response _ Dictionary new.
	response at: 'cartId' put: cartId.
	Arequest send200Response: (WebUtils jsonEncode: response).
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:11:01' prior: 50339035!
                    handleCreateCartRequest: aRequest
	| cartId clientId clientPassword response |
	
	clientId _ (aRequest fields at: 'clientId') asNumber.
	clientPassword _ aRequest fields at: 'password'.
	cartId _ shop createCartClientId: clientId password: clientPassword.
	
	response _ Dictionary new.
	response at: 'cartId' put: cartId.
	aRequest send200Response: (WebUtils jsonEncode: response).
! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:11:45'!
    handleAddToCartRequest: request
	
	| bookIsbn bookQuantity cartId response |
	cartId _ (request fields at: 'cartId') asNumber .
	bookIsbn _ request fields at: 'bookIsbn'.
	bookQuantity _ (request fields at: 'bookQuantity') asNumber.
	
	shop add: bookQuantity of: bookIsbn to: cartId.
	
	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	request send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:11:53' prior: 50339066!
                          handleAddToCartRequest: request
	| bookIsbn bookQuantity cartId response |
	
	cartId _ (request fields at: 'cartId') asNumber .
	bookIsbn _ request fields at: 'bookIsbn'.
	bookQuantity _ (request fields at: 'bookQuantity') asNumber.
	
	shop add: bookQuantity of: bookIsbn to: cartId.
	
	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	request send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:11:56' prior: 50339083!
                          handleAddToCartRequest: aRequest
	| bookIsbn bookQuantity cartId response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	bookIsbn _ aRequest fields at: 'bookIsbn'.
	bookQuantity _ (aRequest fields at: 'bookQuantity') asNumber.
	
	shop add: bookQuantity of: bookIsbn to: cartId.
	
	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	aRequest send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:12:24'!
     handleListCart: request
	| cartId cartItems response |
	cartId _ (request fields at: 'cartId') asNumber .
	cartItems _ shop listCart: cartId.
	
	response _ Dictionary new.
	response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
	request send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:12:29' prior: 50339116!
                              handleListCart: request
	| cartId cartItems response |
	
	cartId _ (request fields at: 'cartId') asNumber .
	cartItems _ shop listCart: cartId.
	
	response _ Dictionary new.
	response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
	request send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:12:34' prior: 50339130!
                            handleListCart: aRequest
	| cartId cartItems response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	cartItems _ shop listCart: cartId.
	
	response _ Dictionary new.
	response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
	aRequest send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:13:19'!
         handleCheckOutCart: request
			| cartId cced ccedSplitted ccn cco creditCard response |
	cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:13:40' prior: 50339157!
  handleCheckOutCart: request
	| cartId cced ccedSplitted ccn cco creditCard response |
	
	cartId _ (request fields at: 'cartId') asNumber .
	ccn _ request fields at: 'ccn' .
	ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
	cco _ request fields at: 'cco'.
	cced _ GregorianMonthOfYear 
		yearNumber: (ccedSplitted at: 2) asNumber
		monthNumber: (ccedSplitted at: 1) asNumber. 
	creditCard _ CreditCard number: ccn owner: cco expiration: cced.

	shop checkOut: cartId payingWith: creditCard.

	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	request send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:13:45' prior: 50339181!
                              handleCheckOutCart: aRequest
	| cartId cced ccedSplitted ccn cco creditCard response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	ccn _ aRequest fields at: 'ccn' .
	ccedSplitted _ (aRequest fields at: 'cced') findTokens: '/'.
	cco _ aRequest fields at: 'cco'.
	cced _ GregorianMonthOfYear 
		yearNumber: (ccedSplitted at: 2) asNumber
		monthNumber: (ccedSplitted at: 1) asNumber. 
	creditCard _ CreditCard number: ccn owner: cco expiration: cced.

	shop checkOut: cartId payingWith: creditCard.

	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:14:52' prior: 50338860!
                        configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | | cartId bookIsbn bookQuantity response | [
			cartId _ (request fields at: 'cartId') asNumber .
			bookIsbn _ request fields at: 'bookIsbn'.
			bookQuantity _ (request fields at: 'bookQuantity') asNumber.
			
			shop add: bookQuantity of: bookIsbn to: cartId.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:15:08' prior: 50339229!
                            configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | 
		self handleAddToCartRequest: request.
	].

	self addService: '/listCart' action: [ :request | | cartId response cartItems | [
			cartId _ (request fields at: 'cartId') asNumber .
			cartItems _ shop listCart: cartId.
			
			response _ Dictionary new.
			response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:15:27' prior: 50339295!
                   configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | 
		self handleAddToCartRequest: request.
	].

	self addService: '/listCart' action: [ :request |
		self handleListCart: request.
	].

	self addService: '/checkOutCart' action: [ :request | | cartId ccn cced ccedSplitted cco creditCard response | [
			cartId _ (request fields at: 'cartId') asNumber .
			ccn _ request fields at: 'ccn' .
			ccedSplitted _ (request fields at: 'cced') findTokens: '/'.
			cco _ request fields at: 'cco'.
			cced _ GregorianMonthOfYear 
				yearNumber: (ccedSplitted at: 2) asNumber
				monthNumber: (ccedSplitted at: 1) asNumber. 
			creditCard _ CreditCard number: ccn owner: cco expiration: cced.
			
			shop checkOut: cartId payingWith: creditCard.
			
			response _ Dictionary new.
			response at: 'response' put: 'OK'.
			request send200Response: (WebUtils jsonEncode: response).
		] on: Error do: [ :anError |
			request send400Response: (anError messageText) 
		]
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:15:49' prior: 50339347!
                   configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | 
		self handleAddToCartRequest: request.
	].

	self addService: '/listCart' action: [ :request |
		self handleListCart: request.
	].

	self addService: '/checkOutCart' action: [ :request | 
		self handleCheckOutCart: request.
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:16:12'!
       handleListCartRequest: aRequest
	| cartId cartItems response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	cartItems _ shop listCart: cartId.
	
	response _ Dictionary new.
	response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
	aRequest send200Response: (WebUtils jsonEncode: response).! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:16:12' prior: 50339388!
                  configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | 
		self handleAddToCartRequest: request.
	].

	self addService: '/listCart' action: [ :request |
		self handleListCartRequest: request.
	].

	self addService: '/checkOutCart' action: [ :request | 
		self handleCheckOutCart: request.
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !

!methodRemoval: TusLibrosRestInterface #handleListCart: stamp: 'AW 6/29/2021 00:16:12'!
handleListCart: aRequest
	| cartId cartItems response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	cartItems _ shop listCart: cartId.
	
	response _ Dictionary new.
	response at: 'items' put: (BagSerializer bag: cartItems) asDictionaryArray .
	aRequest send200Response: (WebUtils jsonEncode: response).!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:16:22'!
            handleCheckOutCartRequest: aRequest
	| cartId cced ccedSplitted ccn cco creditCard response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	ccn _ aRequest fields at: 'ccn' .
	ccedSplitted _ (aRequest fields at: 'cced') findTokens: '/'.
	cco _ aRequest fields at: 'cco'.
	cced _ GregorianMonthOfYear 
		yearNumber: (ccedSplitted at: 2) asNumber
		monthNumber: (ccedSplitted at: 1) asNumber. 
	creditCard _ CreditCard number: ccn owner: cco expiration: cced.

	shop checkOut: cartId payingWith: creditCard.

	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	aRequest send200Response: (WebUtils jsonEncode: response).


! !
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:16:22' prior: 50339421!
                 configRoutes
	
	
	self addService: '/createCart' action: [ :request | 
		self handleCreateCartRequest: request.
	].

	self addService: '/addToCart' action: [ :request | 
		self handleAddToCartRequest: request.
	].

	self addService: '/listCart' action: [ :request |
		self handleListCartRequest: request.
	].

	self addService: '/checkOutCart' action: [ :request | 
		self handleCheckOutCartRequest: request.
	].

	self addService: '/listPurchases' action: [ :request | 
		self handleListPurchasesRequest: request.
	].


! !

!methodRemoval: TusLibrosRestInterface #handleCheckOutCart: stamp: 'AW 6/29/2021 00:16:22'!
handleCheckOutCart: aRequest
	| cartId cced ccedSplitted ccn cco creditCard response |
	
	cartId _ (aRequest fields at: 'cartId') asNumber .
	ccn _ aRequest fields at: 'ccn' .
	ccedSplitted _ (aRequest fields at: 'cced') findTokens: '/'.
	cco _ aRequest fields at: 'cco'.
	cced _ GregorianMonthOfYear 
		yearNumber: (ccedSplitted at: 2) asNumber
		monthNumber: (ccedSplitted at: 1) asNumber. 
	creditCard _ CreditCard number: ccn owner: cco expiration: cced.

	shop checkOut: cartId payingWith: creditCard.

	response _ Dictionary new.
	response at: 'response' put: 'OK'.
	aRequest send200Response: (WebUtils jsonEncode: response).


!

TusLibrosRestInterface allInstances do: [ :x | x destroy ].
tusLibrosWebServer _ TusLibrosRestInterface on: 8080 shopConfiguration: shopConfiguration. 
tusLibrosWebServer startListening.!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AW 6/29/2021 00:17:58' prior: 50338987!
                   handleListPurchasesRequest: aRequest
	| clientId password purchases response |
	
	self halt.
	clientId _ (aRequest fields at: 'clientId') asNumber.
	password _ aRequest fields at: 'password'.
	
	purchases _ shop listPurchasesOf: clientId with: password.
	
	response _ Dictionary new.
	response at: 'purchases' put: (self serializePurchases: purchases).
	aRequest send200Response: (WebUtils jsonEncode: response).


! !

TusLibrosRestInterface allInstances do: [ :x | x destroy ].!

----QUIT----(29 June 2021 00:20:52) CuisUniversity-4532.image priorSource: 124493!